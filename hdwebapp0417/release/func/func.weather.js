define("func/weather",["leaflet","leaflet/weatherLayer","func/base","control/panel","plugins/mcscroll","data/ajax","layout/menu"],function(e){e.ICT.Func.add("weather",{id:"weather",Class:e.Class.extend({initialize:function(){this.menu=e.ict.app.menu,this.util=e.ict.app.util,this.dateUtil=e.ict.app.util.dateTime,this.ajax=new e.ICT.Ajax,this.config=Project_ParamConfig.cdglConfig,this.mapConfig=Project_ParamConfig.MapOptions,this.mymap=e.ict.app.ictmap.map,this.menuid="ict_menu_main_weather",this._popPanel=null,this.w_press="Pressure_",this.w_500mb="500MB_",this.w_wind="Wind_",this.w_wave="WaveHeight_",this.w_surge="Swell_",this.w_current="Current_",this.w_temp="SeaTemp_",this.w_visi="Visibility_",this.arrDate=[],this.layerIds=[],this.a_press=[],this.a_500mb=[],this.a_wind=[],this.a_wave=[],this.a_surge=[],this.a_current=[],this.a_temp=[],this.w_visi="Visibility_",this.layerArr=new Object,this.curType=null,this.weatherLayers=new e.layerGroup},start:function(){this.menu.mainmenu.deactiveMenuExceptOne(this.menuid);if(!e.ICT.Func.UserLogin.getInstance().isLogin()){e.ICT.Func.UserLogin.getInstance().alertLoginDialog(),this.menu.mainmenu.deactiveMenu(this.menuid);return}if(this._popPanel)return;this.mymap=e.ict.app.ictmap.map,this._initUI(),this._initEvts(),this.getWeatherData()},stop:function(){this._popPanel&&this._popPanel.remove(),this.weatherLayers.clearLayers()},_initUI:function(){var t=$.i18n.prop("func_weather_titlename"),n=window.localStorage.getItem("language"),r=125;n=="en"&&(r=245);var i={title:t,width:r,height:300,top:100,left:200,contentHTML:this._getContentHTML()},s=this._popPanel=new e.ICT.PopPanel(i);s.show()},_initEvts:function(){self=this,this._popPanel.on("popPanelRemove",function(){this._popPanel=null,this.menu.mainmenu.deactiveMenu(this.menuid)},this)},_getContentHTML:function(){var e=$.i18n.prop("func_weather_lb_selectweather"),t=$.i18n.prop("func_weather_lb_qy"),n=$.i18n.prop("func_weather_lb_f"),r=$.i18n.prop("func_weather_lb_l"),i=$.i18n.prop("func_weather_lb_y"),s=$.i18n.prop("func_weather_lb_yl"),o=$.i18n.prop("func_weather_lb_hw"),u=$.i18n.prop("func_weather_lb_njd"),a=[];return a.push('   <div class="weather_nav_box_weather"  box-type="display_hide_change" box-display="dishide">'),a.push('           <div class="weather_tyhoon">'),a.push("              <p>"+e+"</p>"),a.push('              <p> <input type="checkbox" name="weather" value="w1"  id="weather1" class="weather_radioclass" style="margin:0px;padding:0px;" /><span class="weatherlab" for="weather1">'+t+"</span></p>"),a.push('              <p> <input type="checkbox" name="weather" value="w2"  id="weather2" class="weather_radioclass" style="margin:0px;padding:0px;"/><span class="weatherlab" for="weather2">500mb</span></p>'),a.push('              <p> <input type="checkbox" name="weather" value="w3"  id="weather3" class="weather_radioclass" style="margin:0px;padding:0px;"/><span class="weatherlab" for="weather3">'+n+"</span></p>"),a.push('              <p> <input type="checkbox" name="weather" value="w4"  id="weather4" class="weather_radioclass" style="margin:0px;padding:0px;"/><span class="weatherlab" for="weather4">'+r+"</span></p>"),a.push('              <p> <input type="checkbox" name="weather" value="w5"  id="weather5" class="weather_radioclass" style="margin:0px;padding:0px;"/><span class="weatherlab" for="weather5">'+i+"</span></p>"),a.push('              <p> <input type="checkbox" name="weather" value="w6"  id="weather6" class="weather_radioclass" style="margin:0px;padding:0px;"/><span class="weatherlab" for="weather6">'+s+"</span></p>"),a.push('              <p  style="display:none"> <input type="checkbox" name="weather" value="w7"  id="weather7" class="weather_radioclass" style="margin:0px;padding:0px;"/><span class="weatherlab"  for="weather7">'+o+"</span></p>"),a.push('              <p> <input type="checkbox" name="weather" value="w8"  id="weather8" class="weather_radioclass" style="margin:0px;padding:0px;"/><span class="weatherlab" for="weather8">'+u+"</span></p>"),a.push("          </div><label>"),a.push("  </div> "),a.join("")},initCheckEvent:function(){$("input[name='weather']").bind("click",function(){var e=$(this).val(),t=$(this).is(":checked");e=="w1"?(self.curWeather=self.w_press,self.changeWeather(self.w_press,self.mymap,t)):e=="w2"?(self.curWeather=self.w_500mb,self.changeWeather(self.w_500mb,self.mymap,t)):e=="w3"?(self.curWeather=self.w_wind,self.changeWeather(self.w_wind,self.mymap,t)):e=="w4"?(self.curWeather=self.w_wave,self.changeWeather(self.w_wave,self.mymap,t)):e=="w5"?(self.curWeather=self.w_surge,self.changeWeather(self.w_surge,self.mymap,t)):e=="w6"?(self.curWeather=self.w_current,self.changeWeather(self.w_current,self.mymap,t)):e=="w7"?(self.curWeather=self.w_temp,self.changeWeather(self.w_temp,self.mymap,t)):e=="w8"&&(self.curWeather=self.w_visi,self.changeWeather(self.w_visi,self.mymap,t))})},getWeatherData:function(){var e=$.i18n.prop("func_weather_error_tip"),t=new Date,n={};n.timespane=t.getTime().toString();var r=self.config.getWeatherInfoUrl;self.ajax.post(r,n,!0,this,function(t){t.state!=1?this._showErrorMsg(e):(this._getWeatherDataSucess(t),this.initCheckEvent())},function(t){this._showErrorMsg(e)})},_getWeatherDataSucess:function(e){e.w_press!=null?this.a_press=e.w_press:$("input[id='weather1']").attr("disabled","disabled"),e.w_500mb!=null?this.a_500mb=e.w_500mb:$("input[id='weather2']").attr("disabled","disabled"),e.w_wind!=null?this.a_wind=e.w_wind:$("input[id='weather3']").attr("disabled","disabled"),e.w_wave!=null?this.a_wave=e.w_wave:$("input[id='weather4']").attr("disabled","disabled"),e.w_surge!=null?this.a_surge=e.w_surge:$("input[id='weather5']").attr("disabled","disabled"),e.w_current!=null?this.a_current=e.w_current:$("input[id='weather6']").attr("disabled","disabled"),e.w_visi!=null?this.a_visi=e.w_visi:$("input[id='weather8']").attr("disabled","disabled")},_getWeatherValue:function(e){var t;e==this.w_press?t=this.a_press:e==this.w_500mb?t=this.a_500mb:e==this.w_wind?t=this.a_wind:e==this.w_wave?t=this.a_wave:e==this.w_surge?t=this.a_surge:e==this.w_current?t=this.a_current:e==this.w_temp?t=[]:e==this.w_visi&&(t=this.a_visi);var n=[];return t!=null&&t.length>0&&n.push(t[0].themetimevalue),n},dateFormat:function(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in n)(new RegExp("("+r+")")).test(t)&&(t=t.replace(RegExp.$1,RegExp.$1.length==1?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t},changeWeather:function(t,n,r){if(!r){var i=this.layerArr[t];for(var s=0;s<i.length;s++)this.weatherLayers.removeLayer(i[s]);return}this.curType=t,this.arrDate=[],this.arrDate=this._getWeatherValue(t);var o=[];for(var s=0;s<this.arrDate.length;s++){var u;s==0?u={type:this.arrDate[s],maxZoom:this.mapConfig.maxZoom,minZoom:this.mapConfig.minZoom,opacity:.7,continuousWorld:!0,id:this.arrDate[s]}:u={type:this.arrDate[s],maxZoom:this.mapConfig.maxZoom,minZoom:this.mapConfig.minZoom,opacity:.7,continuousWorld:!0,id:this.arrDate[s]};var a=e.tileLayer.WeatherLayer("",u);a.id=this.arrDate[s],this.weatherLayers.addLayer(a),a.setOpacity(.7),o.push(a)}for(var s=0;s<this.weatherLayers.getLayers().length;s++)this.layerIds.push(this.weatherLayers.getLayers()[s]._leaflet_id);this.layerArr[t]=o,this.weatherLayers.addTo(n)},_showMsg:function(t){e.ict.app.util.dialog.warn($.i18n.prop("dialog_alert_title"),t)},_showErrorMsg:function(t){e.ict.app.util.dialog.error($.i18n.prop("dialog_alert_title"),t)}})})});