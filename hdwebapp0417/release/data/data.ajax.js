define("data/ajax",["leaflet","core/namespace"],function(e){e.ICT.Ajax=e.Class.extend({_timeout:6e4,_defs:[],initialize:function(){this._defs=[]},setTimeout:function(e){return this._timeout=e,this},getDefs:function(){return this._defs},abort:function(){for(var e=0,t=this._defs.length;e<t;e++)this._defs[e]&&this._defs[e].abort();this._defs=[]},get:function(e,t,n,r,i,s){return s||(s=this.error),this._isCrossDomain(e)?this.request(e,t,n,r,i,s):this._request({url:e,data:t,async:n,dataType:"json",type:"GET",context:r,contentType:"application/x-www-form-urlencoded;",success:i,error:s})},post:function(e,t,n,r,i,s){return s||(s=this.error),this._isCrossDomain(e)&&(e=Project_ParamConfig.defaultAjaxProxy+"?"+e),this._request({url:e,data:t,async:n,dataType:"json",type:"POST",context:r,contentType:"application/x-www-form-urlencoded;",success:i,error:s})},put:function(e,t,n,r,i,s){return s||(s=this.error),$.ajax({url:e,data:t,async:n,context:r,dataType:"text",type:"PUT",timeout:this._timeout,cache:!1,success:i,error:s})},request:function(e,t,n,r,i,s){return s||(s=this.error),$.isEmptyObject(t)||(e=e+"?"+$.param(t)),this._request({url:e,async:n,context:r,dataType:"jsonp",type:"GET",contentType:"application/x-www-form-urlencoded;",success:i,error:s,timeout:this._timeout})},_removeDef:function(e){for(var t=0;t<this._defs.length;t++)this._defs[t]===e&&this._defs.splice(t,1)},_isSamePort:function(e){var t=window.location.port,n=e.split("/")[2].split(":")[1];return t===n},_isCrossDomain:function(e){if(e.indexOf("http")==-1)return!1;if(!this._isSamePort(e))return!0;var t=window.location.hostname,n=e.split("/")[2].split(":")[0];return t.toLowerCase()!==n.toLowerCase()},_request:function(e){var t;try{var n=this;e.error||(e.error=n.error),t=$.ajax({url:e.url,data:e.data,dataType:e.dataType,type:e.type,contentType:"application/x-www-form-urlencoded",async:e.async,cache:!1,context:e.context,timeout:n._timeout}),t.then(function(r){n._removeDef(t);try{e.type!=="text"&&typeof r=="string"&&(r=$.parseJSON(r))}catch(i){console.log(i.message)}e.success.call(e.context,r)},function(r){n._removeDef(t),e.error.call(e.context,r)}),this._defs.push(t)}catch(r){console.log(r.message)}return t},error:function(e){console.log(e.message)}})});