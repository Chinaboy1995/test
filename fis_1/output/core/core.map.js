define("core/map",["leaflet","core/baseobject","core/namespace","leaflet/chartLayer","leaflet/weatherLayer","leaflet/shipDistLayer","leaflet/rasterLayer","leaflet/googleLayer","control/draw","func/realTarget","func/portInfo","data/ajax","control/measure","plugins/contextmenu"],function(e){e.ICT.Map=e.ICT.BaseObject.extend({map:null,_baseLayer:null,_drawTool:null,realtarget:null,portlayer:null,labelType:null,OperateState:{tshf:!1,hjcx:!1,port:!1,wjfx:!1,wjfx_hdyc:!1},initialize:function(t){e.setOptions(this,t),this.ajax=new e.ICT.Ajax;var a=t.baseLayer.center,o=t.baseLayer.zoom,s=t.baseLayer.minZoom,n=t.baseLayer.maxZoom,i=new e.Map("mappanel",{center:new e.latLng(a),zoom:o,minZoom:s,maxZoom:n,crs:e.CRS.EPSG3395,zoomControl:!1,attributionControl:!1,closePopupOnClick:!1,doubleClickZoom:!1,continuousWorld:!0}),r=new e.tileLayer.ChartLayer("",{continuousWorld:!1,id:t.baseLayer.id});i.addLayer(r),this.map=i,e.control.zoom({position:"bottomright"}).addTo(this.map),e.control.scale({position:"bottomleft"}).addTo(this.map),this.map.on("movestart",this._movestartEvt,this).on("moveend",this._moveendEvt,this).on("contextmenu",this._mapContextMenuEvt,this),this.realtarget=new e.ICT.RealTarget(this),this.realtarget.addRealTargetLayer(),this.realtarget.initContextMenu(),this._initMapContextMenu(),this.measureTool=new e.ICT.Measure.Length(this.map,null)},_initMapContextMenu:function(){var e=this;$.contextMenu({selector:"#mappanel",trigger:"none",zIndex:99999,className:"ict_contextmenu_map",callback:function(t,a){e._rightClickCallback(t,a)},items:{bpxs:{name:"标牌显示",items:{"bpxs-shipname":{name:"船名"},"bpxs-ph":{name:"批号"},"bpxs-close":{name:"关闭显示"}}},hqdw:{name:"海区定位",items:{"hqdw-key1":{name:"东黄海区"},"hqdw-key2":{name:"东南沿海海区"},"hqdw-key3":{name:"南海北部海区"},"hqdw-key4":{name:"南沙海区"}}},jlls:{name:"距离量算"}}})},_rightClickCallback:function(e){switch(e){case"bpxs-shipname":this.realtarget.labelAllShip("shipname"),this.labelType="shipname";break;case"bpxs-ph":this.realtarget.labelAllShip("id"),this.labelType="id";break;case"bpxs-close":this.realtarget.hideAlllabel(),this.labelType=null;break;case"hqdw-key1":this.locateToArea("DH");break;case"hqdw-key2":this.locateToArea("DN");break;case"hqdw-key3":this.locateToArea("NH");break;case"hqdw-key4":this.locateToArea("NS");break;case"jlls":this.measureTool.disable(),this.measureTool.enable()}},_movestartEvt:function(e){this._moverstartBounds=e.target.getBounds(),this._startzoom=e.target.getZoom(),this._startcenter=e.target.getCenter()},_moveendEvt:function(e){if(!(this.hasPoppanel()||this.OperateState.tshf||this.OperateState.wjfx||this.OperateState.wjfx_hdyc))if(this._moveendBounds=e.target.getBounds(),this._endzoom=e.target.getZoom(),this._endcenter=e.target.getCenter(),this._moverstartBoundsExtend=this._moverstartBounds.pad(this.realtarget.config.bufferRatio),this._moveendBoundsExtend=this._moveendBounds.pad(this.realtarget.config.bufferRatio),this._endzoom===this._startzoom&&this._startcenter.equals(this._endcenter));else if(this._endzoom!==this._startzoom||this._startcenter.equals(this._endcenter)){if(this._startzoom<this.realtarget.config.showLevel&&this._endzoom<this.realtarget.config.showLevel)return;this._startzoom>=this.realtarget.config.showLevel&&this._endzoom>=this.realtarget.config.showLevel?(this._endzoom>this._startzoom&&this.realtarget.getRealTarget(),this._endzoom<this._startzoom&&this.realtarget.getRealTarget()):this._startzoom<this.realtarget.config.showLevel&&this._endzoom>=this.realtarget.config.showLevel?(this.realtarget.hideShipDistLayer(),this.realtarget.showRealTargetLayer(),this.realtarget.getRealTarget()):this._startzoom>=this.realtarget.config.showLevel&&this._endzoom<this.realtarget.config.showLevel&&(this.realtarget.hideRealTargetLayer(),this.realtarget.showShipDistLayer())}else this._endzoom>=this.realtarget.config.showLevel&&(this._moveendBoundsExtend.intersects(this._moverstartBoundsExtend),this.realtarget.getRealTarget())},_mapLoadEvt:function(){},_mapZoomEndEvt:function(){},_mapMoveEndEvt:function(){},_mapClickEvt:function(){},_mapdblClickEvt:function(){},_mapResizeEvt:function(){},_mapContextMenuEvt:function(e){var t=this.map.getContainer(),a=e.containerPoint.x+t.offsetLeft,o=e.containerPoint.y+t.offsetTop;$(".leaflet-marker-rightclick-icon").length>0&&$(".leaflet-marker-rightclick-icon").contextMenu(!1),$("#mappanel").contextMenu(!0),$("#mappanel").contextMenu({x:a,y:o})},activate:function(t,a,o,s){switch(this.deactivate(),this.setCursor(t),t){case e.ICT.MapMouseState.PAN:break;case e.ICT.MapMouseState.ZOOM_IN:this.map.zoomIn();break;case e.ICT.MapMouseState.ZOOM_OUT:this.map.zoomOut();break;case e.ICT.MapMouseState.POINT:null==this._drawTool&&(this._drawTool=new e.ICT.Draw(this.map)),this._drawTool.point(a,s);break;case e.ICT.MapMouseState.POLYLINE:null==this._drawTool&&(this._drawTool=new e.ICT.Draw(this.map)),this._drawTool.polyline(a,s);break;case e.ICT.MapMouseState.PATH:null==this._drawTool&&(this._drawTool=new e.ICT.Draw(this.map)),this._drawTool.path(a,s);break;case e.ICT.MapMouseState.CIRCLE:null==this._drawTool&&(this._drawTool=new e.ICT.Draw(this.map)),this._drawTool.circle(a,s);break;case e.ICT.MapMouseState.RECTANGLE:null==this._drawTool&&(this._drawTool=new e.ICT.Draw(this.map)),this._drawTool.rectangle(a,s);break;case e.ICT.MapMouseState.POLYGON:null==this._drawTool&&(this._drawTool=new e.ICT.Draw(this.map)),this._drawTool.polygon(a,s);break;case e.ICT.MapMouseState.MEASURELEN:break;case e.ICT.MapMouseState.MEASUREAREA:}null!=o&&o(),this.status=t},deactivate:function(){this._drawTool&&this._drawTool.disable(),this.setCursor(e.ICT.MapMouseState.PAN)},setCursor:function(t){this.map.getContainer().style.cursor=t==e.ICT.MapMouseState.PAN?"":"default"},setCursorImg:function(e){this.map.getContainer().style.cursor=void 0!=e?"url(themes/images/cursor/"+e+"),auto":""},getBaseLayer:function(){return this._baseLayer},setBaseLayer:function(e){this._baseLayer=e},getMap:function(){return this.map},getCurZoom:function(){return this.map.getZoom()},getMinZoom:function(){return this.map.getMinZoom()},getMaxZoom:function(){return this.map.getMaxZoom()},getBounds:function(){return this.map.getBounds()},getBoundsExtend:function(){return this.map.getBounds().pad(Project_ParamConfig.RealTargetConfig.bufferRatio)},hasPoppanel:function(){return""==this.map.getPane("popupPane").innerHTML?!1:!0},closePoppanel:function(){this.hasPoppanel&&this.map.closePopup()},locateToArea:function(t){switch(t){case"DH":var a=e.latLng(25,119),o=e.latLng(37,126),s=e.latLngBounds(a,o);break;case"DN":var a=e.latLng(21,113),o=e.latLng(30,126),s=e.latLngBounds(a,o);break;case"NH":var a=e.latLng(14,110),o=e.latLng(20,120),s=e.latLngBounds(a,o);break;case"NS":var a=e.latLng(5,109),o=e.latLng(13,119),s=e.latLngBounds(a,o)}this.map.fitBounds(s)}}),e.ICT.MapMouseState={PAN:"pan",ZOOM_IN:"zoom_in",ZOOM_OUT:"zoom_out",POINT:"point",PATH:"path",POLYLINE:"polyline",CIRCLE:"circle",RECTANGLE:"rectangle",POLYGON:"polygon",MEASURELEN:"measurelen",MEASUREAREA:"meausrearea"},e.ICT.ShipIcon={ship1:e.icon({iconUrl:"themes/images/shipIcons/target_1.png",iconSize:[10,22],iconAnchor:[5,11]}),ship2:e.icon({iconUrl:"themes/images/shipIcons/target_2.png",iconSize:[10,22],iconAnchor:[5,11]}),ship3:e.icon({iconUrl:"themes/images/shipIcons/target_3.png",iconSize:[10,22],iconAnchor:[5,11]}),ship4:e.icon({iconUrl:"themes/images/shipIcons/target_4.png",iconSize:[10,22],iconAnchor:[5,11]}),ship5:e.icon({iconUrl:"themes/images/shipIcons/target_5.png",iconSize:[10,22],iconAnchor:[5,11]}),ship6:e.icon({iconUrl:"themes/images/shipIcons/target_6.png",iconSize:[10,22],iconAnchor:[5,11]}),ship7:e.icon({iconUrl:"themes/images/shipIcons/target_7.png",iconSize:[10,22],iconAnchor:[5,11]}),ship8:e.icon({iconUrl:"themes/images/shipIcons/target_8.png",iconSize:[10,22],iconAnchor:[5,11]})}});