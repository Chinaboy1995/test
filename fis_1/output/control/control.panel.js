define("control/panel",["leaflet","core/namespace","plugins/mcscroll","util/tool"],function(t){t.ICT.Panel=t.Class.extend({initialize:function(){}}),t.ICT.PopPanel=t.ICT.Panel.extend({includes:t.Mixin.Events,options:{title:"add your title",width:400,height:300,position:"center",left:null,right:null,top:null,bottom:null,zIndex:1e3,scroll:!1,className:null,isDrag:!0,ismodal:!1,animation:!0,disableSelect:!0,contentHTML:"<span>add your content here</span>"},initialize:function(i){t.setOptions(this,i),this.options.ismodal&&(this.options.isDrag=!1),this._isShow=!1,this._container=null},show:function(){return null===this._container&&(this._initUi(),this._initEvents()),this._isShow||(this.options.animation?this._container.fadeIn("fast"):this._container.show(),this._isShow=!0),this},close:function(){return null!==this._container&&this._isShow&&(this.options.animation?this._container.fadeOut():this._container.hide(),this._isShow=!1),this},remove:function(t){void 0===t&&(t=!0),this._container&&(this._container.remove(),this._container=null,t&&this.fire("popPanelRemove",{obj:this}))},getContainer:function(){return this._container},setContent:function(t){null===this._container&&(this._initUi(),this._initEvents());var i=t;"string"==typeof t&&(i=$(t));var n=$('<div class="container-content"></div>');return n.append(i),this._container.find(".container-content").remove(),this._container.append(n),this._setContentCss(),this.options.scroll&&n.mCustomScrollbar({theme:"minimal-dark"}),this},_initUi:function(){var i=$('<div class="ictPanel-popPanel-container"></div>'),n=$('<div class="container-title"></div>'),e=$('<div class="container-content"></div>'),s="<span>"+this.options.title+'</span><img class="close" src="themes/images/dialog/dialog_close.png"/>';i.attr("id","ictPanel-popPanel-container"+t.stamp({})),n.attr("id","container-title"+t.stamp({})),n.html(s),e.html(this.options.contentHTML),i.append(n).append(e),this.options.ismodal&&i.prepend('<div class="ict_modal_backdrop"></div>'),$("body").append(i),this.options.className&&i.addClass(this.options.className),this.options.disableSelect&&i.addClass("disableSelect"),this.options.scroll&&e.mCustomScrollbar({theme:"minimal-dark"}),this.options.isDrag&&t.ict.app.util.tool.drag(i.attr("id"),n.attr("id")),this._container=i,this._setCotainerCss(),this._setTitleCss(),this._setContentCss()},_setCotainerCss:function(){var t={position:"fixed",display:"none",backgroundColor:"#fff"};this.options.left&&(t.left=this.options.left+"px"),this.options.right&&(t.right=this.options.right+"px"),this.options.top&&(t.top=this.options.top+"px"),this.options.bottom&&(t.bottom=this.options.bottom+"px"),this.options.left||this.options.right||this.options.top||this.options.bottom||(t.left=0,t.right=0,t.top=0,t.bottom=0,t.marginLeft="auto",t.marginRight="auto",t.marginBottom="auto",t.marginTop="auto"),t.width=this.options.width+"px",t.height=this.options.height+"px",t.border="1px solid rgb(169, 169, 169)",t.borderRadius="6px",t.boxShadow="silver 2px 2px 5px",t.zIndex=this.options.zIndex,this._container.css(t)},_setTitleCss:function(){this._container.find(".container-title").css({position:"relative",left:0,top:0,width:"100%",height:"35px",backgroundColor:"#244474",lineHeight:"35px",textAlign:"center",cursor:"pointer",borderTopLeftRadius:"6px",borderTopRightRadius:"6px"}).find("span").css({fontSize:"14px",fontWeight:"normal",color:"#fff"}).end().find("img").css({"float":"right",margin:"10px"})},_setContentCss:function(){this._container.find(".container-content").css({position:"relative",left:0,top:0,width:"100%",overFlowX:"hidden",overFlowY:"auto",padding:"10px",backgroundColor:"#fff",borderBottomLeftRadius:"6px",borderBottomRightRadius:"6px"});var t=this._container.height()-this._container.find(".container-title").height();this._container.find(".container-content").outerHeight(t)},_initEvents:function(){var t=this;this._container.find(".container-title .close").on("click",function(){t.remove()}),this._container.find(".ict_modal_backdrop").on("click",function(){t.remove()})}}),t.ICT.DrawPopPanel=t.ICT.PopPanel.extend({initialize:function(i,n,e){this.layer=i,this.layerType=n,this.tool=t.ict.app.util.tool;var e=e||{};switch(e.width=400,e.height=202,n){case"circle":e.contentHTML=this.getCircleContent(),e.title="绘制圆形区域";break;case"rectangle":e.contentHTML=this.getRectContent(),e.title="绘制矩形区域";break;case"polygon":e.contentHTML=this.getPolygonContent(),e.title="绘制多边形区域",e.height=300}t.ICT.PopPanel.prototype.initialize.call(this,e)},updateContent:function(){switch(this.layerType){case"circle":var t=this.getCircleContent();break;case"rectangle":var t=this.getRectContent();break;case"polygon":var t=this.getPolygonContent()}this.setContent(t),this._initEvents()},getCircleContent:function(){var i=this.layer.getLatLng(),n=this.layer.getRadius();n=t.ict.app.util.tool.convertMileToNmile(n);var e=[];return e.push('<div class="drawPopPanel circleContainer">'),e.push("<ul>"),e.push("<li><label>圆心:</label>"+this.getItemHtml(i)+"</li>"),e.push('<li><label>半径:</label><input type="number" class="circleRadius" value="'+n+'">&nbsp&nbsp<label>海里(nmi)</label></li>'),e.push("</ul>"),e.push(this.getBtnHTML()),e.push("</div>"),e.join("")},getRectContent:function(){var t=this.layer.getBounds().getSouthWest(),i=this.layer.getBounds().getNorthEast(),n=[];return n.push('<div class="drawPopPanel rectContainer">'),n.push("<ul>"),n.push("<li><label>左下:</label>"+this.getItemHtml(t)+"</li>"),n.push("<li><label>右上:</label>"+this.getItemHtml(i)+"</li>"),n.push("</ul>"),n.push(this.getBtnHTML()),n.push("</div>"),n.join("")},getPolygonContent:function(){var t=this.layer.getLatLngs(),i=[];t=t[0],i.push('<div class="drawPopPanel polygonContainer">'),i.push("<div><ul>");for(var n=0,e=t.length;e>n;n++)i.push("<li><label>"+(n+1)+"</label>"+this.getItemHtml(t[n])+"</li>");return i.push("</ul></div>"),i.push(this.getBtnHTML()),i.push("</div>"),i.join("")},getBtnHTML:function(){var t=[];return t.push('<div class="btnDiv">'),t.push('<button type="button" class="btn okBtn">确定</button>'),t.push('<button type="button" class="btn cancelBtn">取消</button>'),t.push("</div>"),t.join("")},getItemHtml:function(t){var i=[],n=this.tool.latlngTodfm(t.lat,"lat"),e=this.tool.latlngTodfm(t.lng,"lng");return i.push('<table class="latlngsTable">'),i.push("<tr>"),i.push('<td class="lat lat_d"><input type="text" value="'+n[0]+'"></td>'),i.push('<td class="dfm">°</td>'),i.push('<td class="lat lat_f"><input type="text" value="'+n[1]+'"></td>'),i.push('<td class="dfm">′</td>'),i.push('<td class="lat lat_m"><input type="text" value="'+n[2]+'"></td>'),i.push('<td class="dfm">″</td>'),"N"==n[3]?(i.push('<td class="latNS lat_N active">N</td>'),i.push('<td class="latNS lat_S">S</td>')):(i.push('<td class="latNS lat_N">N</td>'),i.push('<td class="latNS lat_S active">S</td>')),i.push('<td class="space">&nbsp&nbsp</td>'),i.push('<td class="lng lng_d"><input type="text" value="'+e[0]+'"></td>'),i.push('<td class="dfm">°</td>'),i.push('<td class="lng lng_f"><input type="text" value="'+e[1]+'"></td>'),i.push('<td class="dfm">′</td>'),i.push('<td class="lng lng_m"><input type="text" value="'+e[2]+'"></td>'),i.push('<td class="dfm">″</td>'),"W"==e[3]?(i.push('<td class="lngWE lng_W active">W</td>'),i.push('<td class="lngWE lng_E">E</td>')):(i.push('<td class="lngWE lng_W">W</td>'),i.push('<td class="lngWE lng_E active">E</td>')),i.push("</tr>"),i.push("</table>"),i.join("")},getLatLngs:function(){for(var i=[],n=this._container.find(".latlngsTable"),e=0,s=n.length;s>e;e++){var a=$(n[e]).find("tr"),o=a.find(".lat_d input").val(),l=a.find(".lat_f input").val(),h=a.find(".lat_m input").val(),r=a.find(".latNS.active").text(),d=a.find(".lng_d input").val(),c=a.find(".lng_f input").val(),p=a.find(".lng_m input").val();we=a.find(".lngWE.active").text();var u=Math.abs(parseFloat(o))+parseFloat(l/60)+parseFloat(h/3600),g=Math.abs(parseFloat(d))+parseFloat(c/60)+parseFloat(p/3600);u="S"==r?-u:u,g="W"==we?-g:g;var b=t.latLng([u,g]);i.push(b)}return i},getCircleRadius:function(){var t=this._container.find(".circleContainer .circleRadius").val();return parseFloat(t)},_latlngChangeEvt:function(){this.layer.editing&&this.layer.editing.disable();var i=this.getLatLngs();if("circle"==this.layerType){var n=this.getCircleRadius();this.layer.setLatLng(i[0]),this.layer.setRadius(n)}else if("rectangle"==this.layerType){var e=t.latLngBounds(i);this.layer.setBounds(e)}else"polygon"==this.layerType&&this.layer.setLatLngs(i);this.layer.editing&&this.layer.editing.enable()},_initEvents:function(){var t=this;t._container.find(".container-title .close").on("click",function(i){i.stopPropagation(),t.remove(),t.layer.remove(),t.layer=null,t.fire("CancelDraw",{obj:t})}),t._container.find(".container-content .okBtn").on("click",function(i){i.stopPropagation(),t.remove(),t.layer.editing&&t.layer.editing.disable(),t.fire("OkDraw",{layer:t.layer,obj:t})}),t._container.find(".container-content .cancelBtn").on("click",function(i){i.stopPropagation(),t.remove(),t.layer.remove(),t.layer=null,t.fire("CancelDraw",{obj:t})}),t._container.find(".container-content input").on("change focusout",function(){t._latlngChangeEvt()}),t._container.find(".container-content .latlngsTable .latNS").on("click",function(){$(this).addClass("active").siblings(".latNS").removeClass("active"),t._latlngChangeEvt()}),t._container.find(".container-content .latlngsTable .lngWE").on("click",function(){$(this).addClass("active").siblings(".lngWE").removeClass("active"),t._latlngChangeEvt()})}}),t.ICT.TablePanel=t.Class.extend({includes:t.Mixin.Events,options:{height:100,thData:[],tbData:[],thLineHeight:34,tbLineHeight:32},initialize:function(i){t.setOptions(this,i),this._tableObj=null},getTableObj:function(){return null===this._tableObj&&this._init(),this._tableObj},getTableHTML:function(){return null===this._tableObj&&this._init(),this._tableObj.get(0).outerHTML},updateData:function(){},addTo:function(t){return null===this._tableObj&&this._init(),t.html(this._tableObj),this._tableObj.find(".tbDiv").mCustomScrollbar({theme:"minimal-dark"}),this._initStyle(),this},_init:function(){this._initUi(),this._initEvents()},_initUi:function(){for(var t=$('<div class="tableDiv"></div>'),i=$('<div class="thDiv"></div>'),n=$('<div class="tbDiv"></div>'),e="",s="",a=!1,o=0,l=this.options.thData.length;l>o;o++)this.options.thData[o].width&&(a=!0);e+="<table><tr>";for(var o=0,l=this.options.thData.length;l>o;o++)e+=a===!0&&this.options.thData[o].width?'<td style="width:'+this.options.thData[o].width+'%">'+this.options.thData[o].value+"</td>":"<td>"+this.options.thData[o].value+"</td>";e+="</tr></table>",i.html(e),s+="<table>";for(var o=0,l=this.options.tbData.length;l>o;o++){s+="undefined"!=typeof this.options.tbData[o].data_id?'<tr data-id="'+this.options.tbData[o].data_id+'">':"<tr>";for(var h=0;h<this.options.thData.length;h++)s+=a===!0&&this.options.thData[h].width?'<td style="width:'+this.options.thData[h].width+'%">'+this.options.tbData[o][this.options.thData[h].name]+"</td>":"<td>"+this.options.tbData[o][this.options.thData[h].name]+"</td>";s+="</tr>"}s+="</table>",n.html(s),t.append(i).append(n),this._tableObj=t},_initStyle:function(){if(null!==this._tableObj){var t=this.options.height-this.options.thLineHeight,i=parseInt(t/this.options.tbLineHeight),n=parseInt(t/i);this._tableObj.css({position:"relative",width:"100%",height:this.options.height+"px",borderBottom:"solid 1px #d1d1d1",margin:0,padding:0}),this._tableObj.find(".thDiv").css({position:"relative",width:"100%",height:this.options.thLineHeight+"px",overflow:"hidden",margin:0,padding:0}),this._tableObj.find(".tbDiv").css({position:"relative",width:"100%",height:t+"px",margin:0,padding:0}),this._tableObj.find("table").css({tableLayout:"fixed",borderCollapse:"collapse",width:"100%"}),this._tableObj.find(".thDiv table tr").css({fontWeight:"bold",fontSize:"11px",backgroundColor:"rgb(243,243,243)",lineHeight:this.options.thLineHeight+"px"}),this._tableObj.find(".tbDiv table tr").css({lineHeight:n+"px"}),this._tableObj.find("table td").css({border:"solid 1px #d1d1d1",textAlign:"center"})}},_initEvents:function(){}})});