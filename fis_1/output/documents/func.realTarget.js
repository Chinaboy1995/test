define("func/realTarget",["leaflet","func/base","core/namespace","leaflet/shipDistLayer","leaflet/rotateMarker","plugins/contextmenu","data/ajax","data/webSocket","func/tshf","func/hjcx","control/panel"],function(t){t.ICT.RealTarget=t.Class.extend({_allRealTargetList:[],_filterRealTargetList:[],_filterLayers:[],_shipdistLayer:null,_realTargetFeatureGroup:null,rightClickTargetData:null,rightClickTarget:null,clickTarget:null,_websocket:null,_shipSelectMarker:null,initialize:function(e){this.ajax=new t.ICT.Ajax,this.config=Project_ParamConfig.RealTargetConfig,this.ictmap=e,this._realTargetFeatureGroup=t.featureGroup([]),this.ictmap.map.addLayer(this._realTargetFeatureGroup),this.shipTypeList=Project_ParamConfig.FilterDisplayConfig.shipTypeList,this.shipFlagList=Project_ParamConfig.FilterDisplayConfig.shipFlagList,this.shipSourceList=Project_ParamConfig.FilterDisplayConfig.shipSourceList,this._initWebSocket()},_initWebSocket:function(){this._websocket=new t.ICT.WebSocket(this.config.shipRealSocketUrl),this._websocket.onMessage(function(e){var i=JSON.parse(e.data);t.ICT.Func.HJCX_HJXS.getInstance().updateHJ(i),t.ICT.Func.HJCX_HJKZ.getInstance().hjkzUpdateTarget(i),this.socketMsgHandler(i)},this)},sendMsg:function(){var t=this.getCurRect(),e=Project_ParamConfig.CurrentMode,i=[];i.push(parseFloat(t.ldlon),parseFloat(t.ldlat),parseFloat(t.rulon),parseFloat(t.rulat),e),i=i.join("~"),this._websocket.send(i)},socketMsgHandler:function(t){if(1==t.state&&!(t.msg.shipList.length<=0||this.ictmap.getCurZoom()<this.config.showLevel||this.ictmap.OperateState.tshf||this.ictmap.OperateState.port||this.ictmap.OperateState.wjfx||this.ictmap.OperateState.wjfx_hdyc)){var e=t.msg.shipList;console.log("接收到实时数据，条数："+e.length);for(var i=0,a=e.length;a>i;i++){var r=this.convertTargetObj(e[i]);this.isInCurBound(r)&&this.checkFilter(r)&&this.updateFilterLayerWebSocket(r)}}},isInCurBound:function(e){var i=!1,a=t.latLng(e.lat,e.lon),r=this.ictmap.getBounds();return r.contains(a)&&(i=!0),i},getRealTarget:function(){if(this.ictmap.map.getZoom()<this.config.showLevel)return void this.showShipDistLayer();var e=this.config.shipRealUrl,i={};i.limit=this.config.limit,i.timeout=this.config.timeout,i.mode=Project_ParamConfig.CurrentMode,i=t.extend(i,this.getCurRectExtend()),this.ajax.post(e,i,!0,this,function(t){if(1!==t.state)console.error(t.msg);else{var e=t.msg.shipList;this._allRealTargetList=[];for(var i=0,a=e.length;a>i;i++){var r=this.convertTargetObj(e[i]);this._allRealTargetList.push(r)}this.updateFilterList(),this.firstAddRealTargetLayer(),this.sendMsg()}},function(){})},getRealTarget2:function(){if(this.ictmap.map.getZoom()<this.config.showLevel)return void this.showShipDistLayer();var e=this.config.shipRealUrl,i={};i.limit=this.config.limit,i.timeout=this.config.timeout,i.mode=Project_ParamConfig.CurrentMode,i=t.extend(i,this.getCurRectExtend()),this.ajax.post(e,i,!0,this,function(t){if(1!==t.state)console.error(t.msg);else{var e=t.msg.shipList;this._allRealTargetList=[];for(var i=0,a=e.length;a>i;i++){var r=this.convertTargetObj(e[i]);this._allRealTargetList.push(r)}this.updateFilterList(),this.updateFilterLayer(),this.sendMsg()}},function(){})},convertTargetObj:function(t){var e={};return e.country=this.getDetialConvertName(t.co,"country"),e.infotype=t.mt,e.infosrc=t.ms,e.num=t.nu,e.lon=parseFloat(t.lo/6e5),e.lat=parseFloat(t.la/6e5),e.dir=parseFloat(parseInt(t.di/10).toFixed(1)),e.heading=t.he,e.shipname=t.sn.replace(/@/g,"")||"未知",e.shiptype=this.getDetialConvertName(t.st,"ship_type"),e.time=t.ti,e.speed=t.sp/10,e.id=this.getShipIdMode(t).id,e.mode=this.getShipIdMode(t).mode,e},convertTargetObj2:function(t){var e={};return e.country=t.country_name.replace(/@/g,"")||"其他",e.infotype=t.orig_info_type,e.infosrc=t.orig_info_source,e.num=t.target_id,e.lon=parseFloat(t.longitude/6e5),e.lat=parseFloat(t.latitude/6e5),e.dir=parseFloat((t.direction/10).toFixed(1)),e.heading=t.heading,e.shipname=t.ship_name.replace(/@/g,"")||"未知",e.shiptype=this.getDetialConvertName(t.ship_type,"ship_type"),e.time=t.record_utc_time,e.speed=t.speed/10,e.id=this.getShipIdMode2(t).id,e.mode=this.getShipIdMode2(t).mode,e},getShipIdMode:function(t){var e={id:null,mode:null};return 0===Project_ParamConfig.CurrentMode?(e.id=t.nu,e.mode=0):(e.id=t.nu,e.mode=t.mt),e},getShipIdMode2:function(t){var e={id:null,mode:null};return 0===Project_ParamConfig.CurrentMode?(e.id=t.target_id,e.mode=0):(e.id=t.target_id_orig,e.mode=t.targetIDOrig_Type),e},getDetialConvertName:function(t,e){var i="";if(t.toString&&(t=t.toString()),"ship_type"==e)switch(t){case"1":i="货船";break;case"2":i="搜救船";break;case"3":i="油轮";break;case"4":i="拖轮";break;case"5":i="渔船";break;case"6":i="拖船";break;case"7":i="客船";break;default:i="其他"}else if("country"==e)switch(t){case"中国":i="中国";break;case"美国":i="美国";break;case"英国":i="英国";break;case"法国":i="法国";break;case"俄罗斯":i="俄罗斯";break;default:i="其他"}else if("hwlx"==e)i=t;else if("status"==e)switch(t){case"0":i="机动船在航";break;case"1":i="锚泊";break;case"2":i="船舶失控";break;case"3":i="船舶操作受限";break;default:i=t}else if("fixing_device"==e)switch(t){case"-1":res1="非法";break;case"0":i="默认";break;case"1":i="GPS";break;case"2":i="GLONASS";break;case"3":i="GPS/GLONASS组合";break;case"4":i="Loran-C";break;case"5":i="Chayka";break;case"6":i="综合导航系统";break;case"7":i="观测";break;case"8":i="北斗";break;case"9":case"10":case"11":case"12":case"13":case"14":i="未使用";break;case"15":i="内部GNSS";break;default:i=t}else if("commun_state"==e)switch(t){case"0":i="未知";break;case"1":i="SOTDMA";break;case"2":i="ITDMA";break;default:i=t}else if("pos_accuracy"==e)switch(t){case"0":i="未知";break;case"1":i="定位误差大于10米";break;case"2":i="定位误差小于等于10米";break;default:i=t}else if("orig_info_source"==e)switch(t){case"1":i="农业部";break;case"2":i="海事局";break;case"3":i="海监";break;default:i=t}else if("orig_info_type"==e)switch(t){case"1":i="Argos及海事卫星";break;case"2":i="北斗";break;case"3":i="AIS静态";break;case"4":i="AIS动态";break;case"5":i="LRIT";break;case"7":i="海监";break;case"15":i="综合信息";break;default:i=t}return i},getCurRect:function(){var t={},e=this.ictmap.getBounds(),i=e.getSouthWest(),a=e.getNorthEast();return t.ldlon=parseFloat(i.lng.toFixed(6)),t.ldlat=parseFloat(i.lat.toFixed(6)),t.rulon=parseFloat(a.lng.toFixed(6)),t.rulat=parseFloat(a.lat.toFixed(6)),t},getCurRectExtend:function(){var t={},e=this.ictmap.getBounds().pad(this.config.bufferRatio),i=e.getSouthWest(),a=e.getNorthEast();return t.ldlon=parseFloat(i.lng.toFixed(6)),t.ldlat=parseFloat(i.lat.toFixed(6)),t.rulon=parseFloat(a.lng.toFixed(6)),t.rulat=parseFloat(a.lat.toFixed(6)),t},updateAllTargetList:function(t){for(var e=0,i=this._allRealTargetList.length;i>e;e++){var a=this._allRealTargetList[e];if(t.id===a.id){this.isChange(a,t)&&(this._allRealTargetList[e]=t);break}}e===i&&i<this.config.limit&&this._allRealTargetList.push(t)},updateFilterList:function(){this._filterRealTargetList=[];for(var t=0,e=this._allRealTargetList.length;e>t;t++){var i=this._allRealTargetList[t];this.checkFilter(i)&&this._filterRealTargetList.push(i)}},updateFilterLayerWebSocket:function(e){this.updateAllTargetList(e);for(var i=0,a=this._filterRealTargetList.length;a>i;i++){var r=this._filterRealTargetList[i];if(e.id===r.id&&this.isChange(r,e)){this._filterRealTargetList[i]=e;break}}i===a&&this._filterRealTargetList.length<this.config.limit&&this._filterRealTargetList.push(e);for(var i=0,a=this._filterLayers.length;a>i;i++){var s=this._filterLayers[i],o=s.options.data;if(o.id===e.id&&this.isChange(o,e)){var n=t.latLng(e.lat,e.lon);s.setLatLng(n),s.setRotationAngle(e.dir),s.options.data=e;break}}if(i===a&&this._filterLayers.length<this.config.limit){var h=this.createMarker(e,!0);this._filterLayers.push(h),this._realTargetFeatureGroup&&this._realTargetFeatureGroup.addLayer(h)}},updateFilterLayer:function(){for(var e=0,i=this._filterRealTargetList.length;i>e;e++){for(var a=this._filterRealTargetList[e],r=0,s=this._filterLayers.length;s>r;r++){var o=this._filterLayers[r],n=o.options.data;if(n.id===a.id){if(this.isChange(n,a)){var h=t.latLng(a.lat,a.lon);o.setLatLng(h),o.setRotationAngle(a.dir),o.options.data=a}break}}if(r===s){var l=this.createMarker(a,!0);this._filterLayers.push(l),this._realTargetFeatureGroup&&this._realTargetFeatureGroup.addLayer(l)}}},removeInFilterLayer:function(){var t=this;t._filterLayers=$.map(t._filterLayers,function(e){for(var i=!0,a=e.options.data,r=0,s=t._filterRealTargetList.length;s>r;r++){var o=t._filterRealTargetList[r];if(o.id===a.id){i=!1;break}}return i&&t._realTargetFeatureGroup?(t._realTargetFeatureGroup.removeLayer(e),null):e})},updateFilterLayer2:function(){this._realTargetFeatureGroup.eachLayer(function(t){for(var e=!0,i=t.options.data,a=0,r=this._filterRealTargetList.length;r>a;a++){var s=this._filterRealTargetList[a];if(s.id===i.id){e=!1;break}}e?(t.setOpacity(0),t.off("contextmenu",this._markerRightClickEvt,this),t.off("click",this._markerClickEvt,this)):(t.setOpacity(1),t.on("contextmenu",this._markerRightClickEvt,this),t.on("click",this._markerClickEvt,this))},this)},removeTargetLayerById:function(t){for(var e=0,i=this._filterLayers.length;i>e;e++){var a=this._filterLayers[e];if(t===a.options.data.id&&this._realTargetFeatureGroup){this._filterLayers.splice(e,1),this._realTargetFeatureGroup.removeLayer(a);break}}},firstAddRealTargetLayer:function(){this.removeRealTargetLayer(),this._filterLayers=[];for(var e=0,i=this._filterRealTargetList.length;i>e;e++){var a=this._filterRealTargetList[e],r=this.createMarker(a,!0);this._filterLayers.push(r)}this._realTargetFeatureGroup=t.featureGroup(this._filterLayers),this.ictmap.map.addLayer(this._realTargetFeatureGroup)},removeUnuseTarget:function(){for(var e=this.ictmap.getBoundsExtend(),i=[],a=0,r=this._allRealTargetList.length;r>a;a++){var s=this._allRealTargetList[a],o=t.latLng(s.lat,s.lon);e.contains(o)&&i.push(s)}this._allRealTargetList=i},removeUnuseFilterLayer:function(){for(var t=this.ictmap.getBoundsExtend(),e=[],i=0,a=this._filterLayers.length;a>i;i++){var r=this._filterLayers[i],s=r.getLatLng();t.contains(s)?e.push(r):this._realTargetFeatureGroup&&this._realTargetFeatureGroup.removeLayer(r)}this._filterLayers=e},isChange:function(t,e){var i=!1;return(e.lat!==t.lat||e.lon!==t.lon)&&(i=!0),i},checkFilter:function(t){var e=!1,i=!1,a=!1,r=t.infosrc.toString();(0===this.shipSourceList.length||-1!==this.shipSourceList.indexOf(r))&&(a=!0);var r=t.shiptype.toString();(0===this.shipTypeList.length||-1!==this.shipTypeList.indexOf(r))&&(e=!0);var r=t.country.toString();return(0===this.shipFlagList.length||-1!==this.shipFlagList.indexOf(r))&&(i=!0),e&&i&&a},createMarker:function(e,i){var i=i?i:!1,a=t.latLng(e.lat,e.lon),r=e.shipname,s=this.getTargetIcon(e.shiptype),o={icon:s,rotationAngle:e.dir,rotationOrigin:"center center",title:r,data:e};i&&(o.icon.options.className="leaflet-marker-rightclick-icon");var n=t.marker(a,o);if(this.ictmap.labelType){var h=null;"shipname"===this.ictmap.labelType?h=e.shipname.toString():"id"===this.ictmap.labelType&&(h=e.id.toString()),n.bindTooltip(h,this.getTootipOptions()),n.openTooltip()}return i&&this.addTargetEvt(n),n},addTargetEvt:function(t){t.on("contextmenu",this._markerRightClickEvt,this),t.on("click",this._markerClickEvt,this)},removeTargetEvt:function(t){t.off("contextmenu",this._markerRightClickEvt,this),t.off("click",this._markerClickEvt,this)},_markerRightClickEvt:function(e){t.DomEvent.stopPropagation(e);var i=this.ictmap.map.getContainer(),a=e.containerPoint.x+i.offsetLeft,r=e.containerPoint.y+i.offsetTop;this.rightClickTarget=e.target,this.rightClickTargetData=e.target.options.data,$("#mappanel").contextMenu(!1),$(".leaflet-marker-rightclick-icon").contextMenu(!0),$(".leaflet-marker-rightclick-icon").contextMenu({x:a,y:r})},initContextMenu:function(){var t=this;$.contextMenu({selector:".leaflet-marker-rightclick-icon",trigger:"none",zIndex:99999,className:"ict_contextmenu_ship",callback:function(e,i){t._rightClickCallback(e,i)},items:{bpxs:{name:"标牌显示",items:{"bpxs-shipname":{name:"船名"},"bpxs-ph":{name:"批号"},"bpxs-close":{name:"关闭显示"}}},hjxs:{name:"航迹显示"},xskz:{name:"显示控制",items:{"xskz-key1":{name:"全航迹"},"xskz-key2":{name:"10点"},"xskz-key3":{name:"100点"},"xskz-key4":{name:"1000点"}}},tshf:{name:"态势回放"},addhf:{name:"加入回放列表"}}})},getTootipOptions:function(){return{offset:[0,0],direction:"top",permanent:!0,opacity:.8}},_rightClickCallback:function(e){var i=this.rightClickTargetData,a=this.rightClickTarget;if("bpxs-shipname"===e){var r=i.shipname;a.unbindTooltip(),a.bindTooltip(r,this.getTootipOptions()),a.openTooltip()}else if("bpxs-ph"===e){var s=i.id.toString();a.unbindTooltip(),a.bindTooltip(s,this.getTootipOptions()),a.openTooltip()}else if("bpxs-close"===e)a.unbindTooltip();else if("hjxs"===e){var o=t.ICT.Func.HJCX_HJXS.getInstance();o.start()}else if("xskz-key1"===e){var n=t.ICT.Func.HJCX_HJKZ.getInstance();n.start(0)}else if("xskz-key2"===e){var n=t.ICT.Func.HJCX_HJKZ.getInstance();n.start(10)}else if("xskz-key3"===e){var n=t.ICT.Func.HJCX_HJKZ.getInstance();n.start(100)}else if("xskz-key4"===e){var n=t.ICT.Func.HJCX_HJKZ.getInstance();n.start(1e3)}else if("tshf"===e)t.ICT.Func.TSHFOneShip.run();else if("addhf"===e){var h=t.ICT.Func.TSHFMoreShip.getInstance();h.addTarget(i),h._targetPanel?h.updateList():t.ict.app.util.dialog.success("提示","成功加入回放列表！")}},_markerClickEvt:function(e){var i=e.target,a=this.config.shipInfoUrl,r={};r.shipid=i.options.data.id,r.mode=i.options.data.mode,this.removeSelectMarker(),this.createSelectMarker(e),this.clickTarget=e.target,this.ajax.post(a,r,!0,this,function(e){if(1!==e.state)t.ict.app.util.dialog.error("错误提示",e.msg.error),this.removeShipInfoPopPanel();else{var i=this.convertshipInfoObj(e.msg);this.showShipInfoPopPanel(i),this._initPopEvt()}},function(){this.removeShipInfoPopPanel()})},showShipInfoPopPanel:function(e){if(this._shipinfoPopPanel)return void this._shipinfoPopPanel.setContent(this.getPopupContent(e));var i={title:"船舶信息",width:460,height:330,right:40,top:80,className:"ict_realTarget_popupContainer",contentHTML:this.getPopupContent(e)};this._shipinfoPopPanel=new t.ICT.PopPanel(i),this._shipinfoPopPanel.show(),this._shipinfoPopPanel.on("popPanelRemove",function(){this._shipinfoPopPanel=null,this.removeSelectMarker()},this)},removeShipInfoPopPanel:function(){this._shipinfoPopPanel&&(this._shipinfoPopPanel.remove(),this._shipinfoPopPanel=null)},createSelectMarker:function(e){var i=e.target.getLatLng(),a=t.divIcon({iconSize:[24,24],iconAnchor:[12,12],className:"ict_markerselect_divicon"});this._shipSelectMarker=t.marker(i,{icon:a}),this._shipSelectMarker.on("contextmenu",function(){e.target.fire("contextmenu",e)},this),this._shipSelectMarker.on("click",function(){e.target.fire("click",e)},this),this._shipSelectMarker.addTo(this.ictmap.map),$(".ict_markerselect_divicon").css("border","dotted 2px #f00"),e.target.options.hasSelectState=!0,e.target.on("move",function(t){this._shipSelectMarker&&e.target.options.hasSelectState&&this._shipSelectMarker.setLatLng(t.target.getLatLng())},this)},removeSelectMarker:function(){this._shipSelectMarker&&this.clickTarget&&(this._shipSelectMarker.remove(),this._shipSelectMarker=null,this.clickTarget.options.hasSelectState=!1)},labelAllShip:function(t){this._realTargetFeatureGroup&&this._realTargetFeatureGroup.eachLayer(function(e){var i,a=e.options.data;i="shipname"===t?a.shipname:a.id.toString(),e.unbindTooltip(),e.bindTooltip(i,this.getTootipOptions()),e.openTooltip()},this)},hideAlllabel:function(){this._realTargetFeatureGroup&&this._realTargetFeatureGroup.eachLayer(function(t){t.unbindTooltip()},this)},getTargetIcon:function(e){var e=e.toString(),i=null;switch(e){case"货船":i=t.ICT.ShipIcon.ship1;break;case"搜救船":i=t.ICT.ShipIcon.ship2;break;case"油轮":i=t.ICT.ShipIcon.ship3;break;case"拖轮":i=t.ICT.ShipIcon.ship7;break;case"渔船":i=t.ICT.ShipIcon.ship4;break;case"拖船":i=t.ICT.ShipIcon.ship7;break;case"客船":i=t.ICT.ShipIcon.ship5;break;case"其他":i=t.ICT.ShipIcon.ship6;break;default:i=t.ICT.ShipIcon.ship7}return i},convertshipInfoObj:function(t){var e={};return e.id=-1===t.target_id?t.target_id_orig:t.target_id,e.record_utc_time=t.record_utc_time,e.lon=parseFloat(t.longitude/6e5),e.lat=parseFloat(t.latitude/6e5),e.di=parseInt(t.direction/10).toFixed(1),e.he=t.heading,e.sp=t.speed/10,e.st=this.getDetialConvertName(t.status,"status"),e.rot=t.rot_sensor,e.type=this.getDetialConvertName(t.orig_info_type,"orig_info_type"),e.src=this.getDetialConvertName(t.orig_info_source,"orig_info_source"),e.target_id_orig=t.target_id_orig,e.mmsi=t.mmsi,e.sn=t.ship_name.replace(/@/g,"")||"未知",e.call_sign=t.call_sign.replace(/@/g,"")||"未知",e.imo=t.imo_number,e.des=t.destination,e.eta=t.eta,e.draft=t.draft,e.cn=t.country_name.replace(/@/g,"")||"其他",e.ship_type=this.getDetialConvertName(t.ship_type,"ship_type"),e.cargo_type=t.cargo_type,e.ship_length=t.ship_length,e.ship_breadth=t.ship_breadth,e.fixing_device=this.getDetialConvertName(t.fixing_device,"fixing_device"),e.pos_accuracy=this.getDetialConvertName(t.pos_accuracy,"pos_accuracy"),e.commun_state=this.getDetialConvertName(t.commun_state,"commun_state"),e},getPopupContent:function(e){var i=t.ict.app.util.tool.latlngTodfmStr(e.lat,"lat"),a=t.ict.app.util.tool.latlngTodfmStr(e.lon,"lng"),r=t.ict.app.util.dateTime.getTimeStrFromUnix(e.record_utc_time),s=[];return s.push('<div class="shipInfo_Div">'),s.push('<div class="shipInfo_table_div">'),s.push('<table data-id="'+e.id+'">'),s.push('<tr><td width="18%">批号:</td><td>'+e.id+'</td><td width="18%">信息源:</td><td>'+e.src+"</td></tr>"),s.push("<tr><td>船名:</td><td>"+e.sn+"</td><td>MMSI:</td><td>"+e.mmsi+"</td></tr>"),s.push("<tr><td>IMO:</td><td>"+e.imo+"</td><td>呼号:</td><td>"+e.call_sign+"</td></tr>"),s.push("<tr><td>时间:</td><td>"+r+"</td><td>地区:</td><td>"+e.cn+"</td></tr>"),s.push("<tr><td>航行状态:</td><td>"+e.st+"</td><td>航向:</td><td>"+e.di+"°</td></tr>"),s.push("<tr><td>经度:</td><td>"+a+"</td><td>纬度:</td><td>"+i+"</td></tr>"),s.push("<tr><td>航艏向:</td><td>"+e.he+"°</td><td>转向率:</td><td>"+e.rot+"</td></tr>"),s.push("<tr><td>航速:</td><td>"+e.sp+"节</td><td>通信状态:</td><td>"+e.commun_state+"</td></tr>"),s.push("<tr><td>船舶类型:</td><td>"+e.ship_type+"</td><td>信息类型:</td><td>"+e.type+"</td></tr>"),s.push("</table>"),s.push("</div>"),s.push('<div class="btnDiv">'),s.push('<button type="button" data-id="'+e.id+'" class="daxx">档案信息</button>'),s.push("</div>"),s.push("</div>"),s.join("")},_initPopEvt:function(){$(".ict_realTarget_popupContainer .btnDiv>button").on("click",function(){$(this).data("id");window.open("resultpage/shiprecord.html")})},showShipDistLayer:function(){this._shipdistLayer?this._shipdistLayer.setOpacity(1):(this._shipdistLayer=new t.TileLayer.ShipDistLayer(this.config.shipDistLayerUrl),this.ictmap.map.addLayer(this._shipdistLayer))},hideShipDistLayer:function(){this._shipdistLayer&&this._shipdistLayer.setOpacity(0)},addShipDistLayer:function(){this.removeShipDistLayer(),this._shipdistLayer=new t.TileLayer.ShipDistLayer(this.config.shipDistLayerUrl),this.ictmap.map.addLayer(this._shipdistLayer)},removeShipDistLayer:function(){this._shipdistLayer&&this.ictmap.map.hasLayer(this._shipdistLayer)&&(this._shipdistLayer.remove(),this._shipdistLayer=null)},showRealTargetLayer:function(){this._realTargetFeatureGroup&&this._realTargetFeatureGroup.eachLayer(function(t){t.setOpacity&&t.setOpacity(1),t.setStyle&&t.setStyle({opacity:1,fillOpacity:1}),this.addTargetEvt(t)},this)},hideRealTargetLayer:function(){this._realTargetFeatureGroup&&this._realTargetFeatureGroup.eachLayer(function(t){t.setOpacity&&t.setOpacity(0),t.setStyle&&t.setStyle({opacity:0,fillOpacity:0}),this.removeTargetEvt(t),this.removeShipInfoPopPanel()},this)},removeRealTargetLayer:function(){this._realTargetFeatureGroup&&this._realTargetFeatureGroup.clearLayers()},addRealTargetLayer:function(){this.ictmap.getCurZoom()<this.config.showLevel?(this.showShipDistLayer(),this.removeRealTargetLayer()):(this.hideShipDistLayer(),this.getRealTarget())},locateShip:function(e){this.clearLocatLyr();var i=this.getShipById(e.shipid);if(i)this.ictmap.map.panTo(i.getLatLng()),i.fire("click");else{var a=this.config.shipInfoUrl;this.ajax.post(a,e,!0,this,function(e){if(1!==e.state)t.ict.app.util.dialog.error("错误",e.msg.error);else{var i=(this.convertshipInfoObj(e.msg),this.convertTargetObj2(e.msg));this._locateShiplyr=this.createMarker(i,!0),this.ictmap.map.addLayer(this._locateShiplyr),this._locateShiplyr.fire("click"),this.ictmap.map.panTo(this._locateShiplyr.getLatLng())}},function(){})}},locateShipById:function(t){"undefined"!=typeof t&&this._realTargetFeatureGroup&&this._realTargetFeatureGroup.eachLayer(function(e){var i=e.options.data;i.id==t&&this.ictmap.map.panTo(e.getLatLng())},this)},getShipById:function(t){if(!this._realTargetFeatureGroup)return null;var e=null;return this._realTargetFeatureGroup.eachLayer(function(i){var a=i.options.data;return a.id===t&&0!==i.options.opacity?void(e=i):void 0},this),e},clearLocatLyr:function(){this._locateShiplyr&&(this.ictmap.map.removeLayer(this._locateShiplyr),this._locateShiplyr=null,this.removeShipInfoPopPanel())},isRealTargetShow:function(){var t=!1;return this._realTargetFeatureGroup&&this.ictmap.map.hasLayer(this._realTargetFeatureGroup)&&this.ictmap.map.getZoom()>=this.config.showLevel&&(t=!0),t}})});