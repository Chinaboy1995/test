<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title class="register_title">用户注册</title>
    <link rel="stylesheet" type="text/css" href="../library/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../library/bootstrap/css/bootstrap-theme.css">
    <style type="text/css">
    *{
        font-family: 'Microsoft YaHei';
     }    
    html,body{
        position:absolute;top:0;bottom: 0;left:0;right:0;width:100%;height:100%;
    }
    body{
        background: url('../themes/images/userLogin/BG.jpg');
        background-repeat: no-repeat;
        background-size: 100% 200%;
       -moz-background-size:100% 200%;
       -webkit-background-size:100% 200%;
    }
    .form-group{
        margin-bottom: 0;
    }
    .container{
        width:650px;
    }
    .enroll_logo{
        margin:70px 0 20px 0;
    }
    .register_reminder{
        font-size:30px;
        color:#fff;
        margin-bottom: 30px;
        text-align: right;
        font-weight:normal;
    }
    .register_title_systemname{
        color:#fff;
        font-size:36px;
    }
    .enroll_div{
        background-color: rgba(3,9,20,0.3); 
        border-radius: 6px;
        padding:30px 46px;
        margin-top:10px;
    } 
    .enroll_input_font{
        color:#fff;
        font-size:16px;
        font-weight: normal;
        padding-left: 0;
        padding-right: 0;
    }
    .enroll_error{
        color:#fff;
        font-weight: normal;
    }
    .register_okbtn{
        border:none;
        outline: none;
        height:40px;
        font-size:18px;
        color:#fff;
        background-color: #188bff;
    }

    </style>
    <script type="text/javascript" src="../library/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../project/project.config.js"></script>   
    <script type="text/javascript" src="../plugins/jquery.i18n.properties/jquery.i18n.properties.min.js"></script> 
</head>
<body>
<!--注册页面-->
<div class="container">
    <div class="text-center enroll_logo"><img src="../themes/images/userLogin/logo.png" alt=""/></div>
    <p class=" text-center register_title_systemname"></p>
    <div class="enroll_div">        
        <form class="form-horizontal" onsubmit="return false;">
          <div class="form-group">
              <label class="col-md-4 register_reminder"></label>
          </div>
          <div class="form-group">
            <label for="inputusername" class="col-md-3 control-label enroll_input_font register_username"></label>
            <div class="col-md-9">
              <input type="text" class="form-control enroll_input register_username_placeholder" id="inputusername" placeholder="">
            </div>
          </div>
          <div class="form-group">
              <label class="col-md-offset-3 col-md-9 enroll_error username_error_prompt">&nbsp;</label>
          </div>

          <div class="form-group">
            <label for="inputPassword" class="col-md-3 control-label enroll_input_font register_psw"></label>
            <div class="col-md-9">
              <input type="password" class="form-control enroll_input register_psw_placeholder" id="inputPassword" placeholder="">
            </div>
          </div>
          <div class="form-group">
              <label class="col-md-offset-3 col-md-9 enroll_error password_error_prompt">&nbsp;</label>
          </div> 

          <div class="form-group">
            <label for="inputPasswordConfirm" class="col-md-3 control-label enroll_input_font register_psw_confirm"></label>
            <div class="col-md-9">
              <input type="password" class="form-control enroll_input register_psw_confirm_placeholder" id="inputPasswordConfirm" placeholder="">
            </div>
          </div>
          <div class="form-group">
              <label class="col-md-offset-3 col-md-9 enroll_error againPsd_error_prompt">&nbsp;</label>
          </div>  

          <div class="form-group">
            <label for="inputEmail" class="col-md-3 control-label enroll_input_font register_email"></label>
            <div class="col-md-9">
              <input type="email" class="form-control enroll_input register_email_placeholder" id="inputEmail" placeholder="">
            </div>
          </div>
          <div class="form-group">
              <label class="col-md-offset-3 col-md-9 enroll_error email_error_prompt">&nbsp;</label>
          </div>    

          <div class="form-group">
              <button type="button" class="col-md-12  register_okbtn"></button>
          </div>
          <div class="form-group">
              <label class="col-md-offset-3 col-md-9 enroll_error enrollres_error_prompt">&nbsp;</label>
          </div>  

        </form>
    </div>
</div>
<!-- 注册逻辑 -->
<script type="text/javascript">
    var lang = window.localStorage.getItem("language") || 'zh';
    var $username = $("#inputusername");
    var $psw = $("#inputPassword");
    var $confirmpsw = $("#inputPasswordConfirm");
    var $email = $("#inputEmail");
    var $error = $(".enroll_error");
    var pswPattern =  /^[A-z0-9]{6,12}$/;
    var emailPattern = /^([0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*@(([0-9a-zA-Z])+([-\w]*[0-9a-zA-Z])*\.)+[a-zA-Z]{2,9})$/;

    //中英文对照
    lang === 'zh' ?  '' : lang;
    $.i18n.properties({
        name:'strings', // 资源文件名称
        path:'../languages/', // 资源文件路径
        mode:'both', //vars map both
        language:lang, //ISO-639 指定的语言编码（如：“en”表示英文、“zh”表示中文）
        cache:false, 
        checkAvailableLanguages: true,
        async: false,
        callback:function(){
            $(".register_title").html($.i18n.prop('register_title'));
            $(".register_title_systemname").html($.i18n.prop('register_title_systemname'));
            $(".register_reminder").html($.i18n.prop('register_reminder'));          
            $(".register_username").html($.i18n.prop('register_username'));  
            // $(".register_username_placeholder").attr('placeholder',$.i18n.prop('register_username_placeholder'));  
            $(".register_psw").html($.i18n.prop('register_psw'));
            // $(".register_psw_placeholder").attr('placeholder',$.i18n.prop('register_psw_placeholder'));  
            $(".register_psw_confirm").html($.i18n.prop('register_psw_confirm'));  
            // $(".register_psw_confirm_placeholder").attr('placeholder',$.i18n.prop('register_psw_confirm_placeholder'));  
            $(".register_email").html($.i18n.prop('register_email'));   
            // $(".register_email_placeholder").attr('placeholder',$.i18n.prop('register_email_placeholder'));                                  
            $(".register_okbtn").html($.i18n.prop('register_okbtn'));                             
        }
    }); 
    
    $username.focus();

    $("body").on('keydown',function(e){
        var e = e || window.event;
        if (e.keyCode === 13) {
           $(".register_okbtn").click();
        }

    });

    $(".enroll_logo").on("click",function(){
        window.location.href = "../index.html";
    });

    $(".register_okbtn").on("click",function(){
        var username = $username.val();
            username = $.trim(username);
        var psw = $psw.val();
            psw = $.trim(psw);
        var confirmpsw = $confirmpsw.val();
            confirmpsw = $.trim(confirmpsw);
        var email = $email.val();
            email = $.trim(email);
        
        $error.html('&nbsp;');
        if(username === ''){
            $(".username_error_prompt").text($.i18n.prop('register_error_username')); 
             $username.focus();           
        } else if (psw === ''){
            $(".password_error_prompt").text($.i18n.prop('register_error_psw1'));
            $psw.focus();
        } else if(!pswPattern.test(psw)){
            $(".password_error_prompt").text($.i18n.prop('register_error_psw2'));
        } else if(confirmpsw == ''){
            $(".againPsd_error_prompt").text($.i18n.prop('register_error_psw3'));
            $confirmpsw.focus();
        }else if(psw !== confirmpsw){
            $(".againPsd_error_prompt").text($.i18n.prop('register_error_psw4'));
        } else if(email === ''){
            $(".email_error_prompt").text($.i18n.prop('register_error_email'));
            $email.focus();
        } else if(!emailPattern.test(email)){
            $(".email_error_prompt").text($.i18n.prop('register_error_email2'));
        } else {
            var url = Project_ParamConfig.userConfig.enrollUrl;
            var data = {
               userName:username,
               passWord:psw,
               emailAddress:email
            };           
            $.ajax({
                url:url,
                data:data,
                method:'POST',
                dataType:'JSON',
                success:function(res){
                   //用户名已存在
                   if(res.state === 10010){ 
                      $(".username_error_prompt").html($.i18n.prop('register_error_result1'));
                   } else if(res.state === 10101){
                      $(".email_error_prompt").html($.i18n.prop('register_error_result2'));
                   } else if(res.state === 10102){
                      $(".email_error_prompt").html($.i18n.prop('register_error_result3'));
                   }else if(res.state === 1){                         
                        $("input").val('');
                        window.open('enrollsuccess.html?enrollemail='+email);      
                   }
                },
                error:function(error){
                    $(".email_error_prompt").html($.i18n.prop('register_error_result'));
                }
            });
        }

    });
</script>
</body>
</html>
