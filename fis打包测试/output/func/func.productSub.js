define("func/productSub",["leaflet","func/base","data/ajax","control/panel","control/playback"],function(t){t.ICT.Func.add("ProductSub",{Class:t.Class.extend({id:"ProductSub",initialize:function(){this._container=this._popPanel=null,this._playback=null,this.ajax=new t.ICT.Ajax,this.dialog=t.ict.app.util.dialog,this._map=t.ict.app.ictmap.map},start:function(){this._container||this._popPanel||(this._initUi(),this._initEvts(),this._container.find(".productNav>li:first-child>a").click())},stop:function(){this.ajax.abort(),this._popPanel.remove(),this._container=this._popPanel=null},getContentHtml:function(){var t=[];return t.push('<div class="productSubsContainer">'),t.push('<ul class="nav productNav">'),t.push('<li class="active" data-info="productList"><a href="#" >产品列表</a></li>'),t.push('<li data-info="subscribeList"><a href="#" >订阅列表</a></li>'),t.push("</ul>"),t.push('<div class="listDiv"></div>'),t.push("</div>"),t.join("")},getProductList:function(){var t=[];t.push("<div>"),t.push("<table>"),t.push("<thead>"),t.push("<tr>"),t.push("<th>区域名称</th>"),t.push("<th>时间范围</th>"),t.push("<th>信息模式</th>"),t.push("<th>信息源</th>"),t.push("<th>目标匹数</th>"),t.push("<th>目标点数</th>"),t.push("<th>操作</th>"),t.push("<th>状态</th>"),t.push("</tr>"),t.push("</thead>"),t.push("<tbody>");for(var s=0,i=16;i>s;s++)s%2===0?(t.push("<tr>"),t.push('<td>区域一<button class="locatBtn" type="button"></button></td>'),t.push("<td>2016-10-27 16:00——2016-10-30 16:00</td>"),t.push("<td>原始模式</td>"),t.push("<td>北斗</td>"),t.push("<td>16</td>"),t.push("<td>16</td>"),t.push('<td><button class="subBtn active" type="button" data-info="1">订阅</button></td>'),t.push("<td>已订阅</td>"),t.push("</tr>")):(t.push("<tr>"),t.push('<td>区域一<button class="locatBtn" type="button"></button></td>'),t.push("<td>2016-10-27 16:00——2016-10-30 16:00</td>"),t.push("<td>原始模式</td>"),t.push("<td>北斗</td>"),t.push("<td>16</td>"),t.push("<td>16</td>"),t.push('<td><button class="subBtn" type="button" data-info="0">订阅</button></td>'),t.push("<td>未订阅</td>"),t.push("</tr>"));return t.push("</tbody>"),t.push("</table>"),t.push("</div>"),t.join("")},getSubScribleList:function(){var t=[];t.push("<div>"),t.push("<table>"),t.push("<thead>"),t.push("<tr>"),t.push("<th>区域名称</th>"),t.push("<th>时间范围</th>"),t.push("<th>信息模式</th>"),t.push("<th>信息源</th>"),t.push("<th>操作</th>"),t.push("</tr>"),t.push("</thead>"),t.push("<tbody>");for(var s=0,i=6;i>s;s++)t.push("<tr>"),t.push('<td>区域一<button class="locatBtn" type="button"></button></td>'),t.push("<td>2016-10-27 16:00——2016-10-30 16:00</td>"),t.push("<td>原始模式</td>"),t.push("<td>北斗</td>"),t.push('<td><button class="viewBtn" type="button">查看</button></td>'),t.push("</tr>");return t.push("</tbody>"),t.push("</table>"),t.push("</div>"),t.join("")},_initUi:function(){var s={title:"产品订阅",width:910,height:458,left:200,top:200},i=this._container=$(this.getContentHtml());s.contentHTML=i;var n=new t.ICT.PopPanel(s);n.show(),this._popPanel=n,this._popPanel.on("popPanelRemove",function(){this.stop()},this)},_initEvts:function(){this._container.find("ul>li").on("click",{context:this},this._changeNavEvt)},_changeNavEvt:function(t){var s=t.data.context,i=$(this).data("info");$(this).addClass("active").siblings().removeClass("active"),"productList"===i?s._container.find(".listDiv").html(s.getProductList()).find("div").mCustomScrollbar({theme:"minimal-dark"}):"subscribeList"===i&&s._container.find(".listDiv").html(s.getSubScribleList()).find("div").mCustomScrollbar({theme:"minimal-dark"}),s._tableEvts()},_tableEvts:function(){var s=this;s._container.find(".listDiv table .locatBtn").on("click",function(i){i.preventDefault();var n=t.latLng(40.712,-74.227),a=t.latLng(40.774,-74.125),h=(t.latLngBounds(n,a),s._map.getZoom()>8?s._map.getZoom()-1:s._map.getZoom()+1);s._map.setView([30,114],h)}),s._container.find(".listDiv table .subBtn").on("click",function(){var t=$(this).data("info");"0"==t&&($(this).addClass("active"),$(this).parent().next().html("已订阅"),$(this).data("info","1"))}),s._container.find(".listDiv table .viewBtn").on("click",function(){s.playback()})},playback:function(){this._playback&&(this._playback.close(),this._playback=null);var s={state:1,msg:{shipList:[{maxTime:1478767907,minTime:1478767902,mode:0,num:41249,posList:[{co:290,he:29,la:18462079,lo:73132395,sp:23,ti:1467520200},{co:290,he:29,la:18462079,lo:72352395,sp:23,ti:1467556200},{co:290,he:29,la:18762079,lo:71932395,sp:23,ti:1467592200},{co:290,he:29,la:19122079,lo:71392395,sp:23,ti:1467628200}]},{maxTime:1478767907,minTime:1478767902,mode:0,num:41248,posList:[{co:290,he:29,la:18762079,lo:73732395,sp:23,ti:1467520200},{co:290,he:29,la:18762079,lo:72952395,sp:23,ti:1467556200},{co:290,he:29,la:19062079,lo:72532395,sp:23,ti:1467592200},{co:290,he:29,la:19422079,lo:71992395,sp:23,ti:1467628200}]}]}};s=s.msg.shipList,this._playback=new t.ICT.Control.PlayBack(s,null,function(){},null).show(this._map)}})})});