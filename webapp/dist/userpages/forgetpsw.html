<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title class="forgetpsw_title"></title>
    <link rel="stylesheet" type="text/css" href="../library/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../library/bootstrap/css/bootstrap-theme.css">
    <link rel="stylesheet" href="../themes/css/func.user.css"/>
    <script type="text/javascript" src="../library/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="../project/project.config.js"></script>  
    <script type="text/javascript" src="../plugins/jquery.i18n.properties/jquery.i18n.properties.min.js"></script> 
</head>
<body>
    <div class="container">
        <div style="padding: 20px 0;">
            <img src="../themes/images/userLogin/login_logo.jpg" style="vertical-align: bottom" alt=""/>
            <span class="title_font forgetpsw_title_reminder"></span>
        </div>
    </div>
    <div class="content">
        <div class="content_div" style="padding-top:40px;">
            <div class="input-group  input-group-lg input_div">
                    <span class="input-group-addon" style="background-color: #fff;">
                        <img src="../themes/images/userLogin/username.png" alt=""/>
                    </span>
                <input type="text" class="form-control username forgetpsw_username_placeholder" style="border-left:0;font-size:14px;" placeholder="">
            </div>

            <span class="login_error error_username"></span>
            <div class="input-group  input-group-lg input_div">
                    <span class="input-group-addon" style="background-color: #fff;">
                        <img src="../themes/images/userLogin/email.png" alt=""/>
                    </span>
                <input type="text" class="form-control email forgetpsw_email_placeholder" style="border-left:0;font-size:14px;" placeholder="">
            </div>
            <span class="login_error error_email"></span> <!-- 存放错误提醒-->

            <div class="input_div">
                <button class="form-control  login_btn_div forgetpsw_okbtn"></button>
            </div>
            <div class="text-right input_div">
                <p class="msg" style="height:25px;color:#188bff"></p>
            </div>
        </div>
    </div>
    <!-- 找回密码逻辑 -->
    <script type="text/javascript">
       var lang = window.localStorage.getItem("language") || 'zh';
       var  $username = $(".username");
       var  $email = $(".email");
       var  $error = $(".login_error");
       var emailPattern = /^([0-9a-zA-Z]([-.\w]*[0-9a-zA-Z])*@(([0-9a-zA-Z])+([-\w]*[0-9a-zA-Z])*\.)+[a-zA-Z]{2,9})$/;
    
       $username.focus();

        //中英文对照
        lang === 'zh' ?  '' : lang;
        $.i18n.properties({
            name:'strings', // 资源文件名称
            path:'../languages/', // 资源文件路径
            mode:'both', //vars map both
            language:lang, //ISO-639 指定的语言编码（如：“en”表示英文、“zh”表示中文）
            cache:false, 
            checkAvailableLanguages: true,
            async: true,
            callback:function(){
                $(".forgetpsw_title").html($.i18n.prop('forgetpsw_title'));
                $(".forgetpsw_title_reminder").html($.i18n.prop('forgetpsw_title_reminder'));
                $(".forgetpsw_username_placeholder").attr("placeholder",$.i18n.prop('forgetpsw_username_placeholder'));
                $(".forgetpsw_email_placeholder").attr("placeholder",$.i18n.prop('forgetpsw_email_placeholder'));
                $(".forgetpsw_okbtn").html($.i18n.prop('forgetpsw_okbtn'));                

            }
       });        

      $("body").on('keydown',function(e){
          var e = e || window.event;
          if (e.keyCode === 13) {
             $(".login_btn_div").click();
          }

       });

       $(".login_btn_div").on("click",function(){
          var username = $username.val();
              username = $.trim(username);
          var email = $email.val();
              email = $.trim(email);
           $error.text('');
           if(username === ''){
              $(".error_username").text($.i18n.prop('forgetpsw_username_error'));
              $username.focus();
           } else if(email === ''){
              $(".error_email").text($.i18n.prop('forgetpsw_email_error1'));
              $email.focus();
           } else if(!emailPattern.test(email)){
              $(".error_email").text($.i18n.prop('forgetpsw_email_error2'));
           } else {
                var url = Project_ParamConfig.userConfig.forgetpswUrl;
                var data = {
                   userName:username,
                   emailAddress:email
                };
                $.ajax({
                    url:url,
                    data:data,
                    method:'POST',
                    dataType:'JSON',
                    success:function(res){
                       if(res.state !== 1){
                          // console.error(res.msg.result);
                          // $(".error_email").text('邮箱和用户名不匹配！');
                          $(".error_email").text($.i18n.prop('forgetpsw_res_error'));
                          
                       } else {
                          $(".msg").text($.i18n.prop('forgetpsw_res_success'));
                       }
                    },
                    error:function(error){
                          $(".error_email").text($.i18n.prop('forgetpsw_res_error'));
                    }
                });               
           }
       });
    </script>
</body>
</html>
