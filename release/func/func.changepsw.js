define("func/changepsw",["leaflet","func/base","data/ajax"],function(e){e.ICT.Func.add("ChangePsw",{Class:e.Class.extend({initialize:function(){this._container=null,this._popPanel=null,this.ajax=new e.ICT.Ajax,this.sessionStorage=e.ict.app.sessionStorage,this.dialog=e.ict.app.util.dialog,this.config=Project_ParamConfig.userConfig},start:function(){if(this._popPanel||this._container)return;this._initUi(),this._bindEvts()},stop:function(){this._popPanel&&this._popPanel.remove(),this._container=null,this._popPanel=null},_initUi:function(){var t={title:$.i18n.prop("changepsw_title"),width:486,height:338,ismodal:!0},n=this._container=$(this.getContentHtml());t.contentHTML=n,amendPop=this._popPanel=new e.ICT.PopPanel(t),amendPop.show(),this._popPanel.on("popPanelRemove",function(){this._container=null,this._popPanel=null},this)},getContentHtml:function(){var e=[];return e.push('<div class="amendContainer">'),e.push('     <div class="text-center amend_input"><span class="amend_font changepsw_oldpsw">原密码:</span><input type="password"  id="old_password" autocomplete="off"/><span  class="amend_font"></span><span class=" login_error oldPsd_prompt"></span></div>'),e.push('     <div class="text-center amend_input"><span class="amend_font changepsw_newpsw">新密码:</span><input type="password"  id="new_password" autocomplete="off"/><span  class="amend_font"></span><span class="login_error newPsd_prompt"></span></div>'),e.push('     <div class="text-center amend_input"><span class="amend_font changepsw_confirmpsw">确认密码:</span><input type="password" id="again_new_password"  autocomplete="off"/><span  class="amend_font"></span><span class="login_error again_newPsd_prompt"></span></div>'),e.push('     <div class="text-center "><button class="btn amend_confirm_btn changepsw_okbtn">确定</button><button class="btn amend_cancel_btn changepsw_cancelbtn">取消</button></div>'),e.push("</div>"),e.join("")},_bindEvts:function(){var e=this;e._container.find("#old_password").focus(),e._container.find(".changepsw_oldpsw").html($.i18n.prop("changepsw_oldpsw")),e._container.find(".changepsw_newpsw").html($.i18n.prop("changepsw_newpsw")),e._container.find(".changepsw_confirmpsw").html($.i18n.prop("changepsw_confirmpsw")),e._container.find(".changepsw_okbtn").html($.i18n.prop("changepsw_okbtn")),e._container.find(".changepsw_cancelbtn").html($.i18n.prop("changepsw_cancelbtn")),e._container.find(".amend_confirm_btn").on("click",function(t){$(".oldPsd_prompt").html(""),$(".newPsd_prompt").html(""),$(".again_newPsd_prompt").html("");var n=/^[a-zA-Z0-9]{6,12}$/,r=e._container.find("#old_password").val();r=$.trim(r);var i=e._container.find("#new_password").val();i=$.trim(i);var s=e._container.find("#again_new_password").val();s=$.trim(s);if(r=="")$(".oldPsd_prompt").html($.i18n.prop("changepsw_error_oldpsw"));else if(i=="")$(".newPsd_prompt").html($.i18n.prop("changepsw_error_newpsw"));else if(!n.test(i))$(".newPsd_prompt").html($.i18n.prop("changepsw_error_newpsw2"));else if(s=="")$(".again_newPsd_prompt").html($.i18n.prop("changepsw_error_confirmpsw"));else if(s!==i)$(".again_newPsd_prompt").html($.i18n.prop("changepsw_error_confirmpsw2"));else{var o=e.sessionStorage.getItem("userInfo"),u=e.config.modifypswUrl,a={};a.id=o.userId,a.oldPassWord=r,a.newPassWord=i,e.ajax.post(u,a,!0,e,e._ajaxSucCallback,e._ajaxFaiCallback)}}),e._container.find(".amend_cancel_btn").on("click",function(){e.stop()})},_ajaxSucCallback:function(e){e.state===1?(this.dialog.alert($.i18n.prop("dialog_alert_title"),$.i18n.prop("changepsw_res_success")),this.stop()):e.state===10031?$(".oldPsd_prompt").html($.i18n.prop("changepsw_res_error1")):$(".oldPsd_prompt").html($.i18n.prop("changepsw_res_error"))},_ajaxFaiCallback:function(e){$(".oldPsd_prompt").html($.i18n.prop("changepsw_res_error"))}})})});