define("func/jrtx",["leaflet","func/base","control/panel","plugins/mcscroll","data/ajax","layout/menu"],function(e){e.ICT.Func.add("jrtx",{id:"jrtx",Class:e.Class.extend({initialize:function(){this.menu=e.ict.app.menu,this.util=e.ict.app.util,this.dateUtil=e.ict.app.util.dateTime,this.ajax=new e.ICT.Ajax,this.config=Project_ParamConfig.cdglConfig,this.menuid="ict_menu_main_jrtx",this._popPanel=null,this._pageInfoInit()},start:function(){if(!e.ICT.Func.UserLogin.getInstance().isLogin()){e.ICT.Func.UserLogin.getInstance().alertLoginDialog();return}if(this._popPanel)return;this._initUI(),this._initEvts(),this._eventSearch(!0)},stop:function(){this._popPanel&&this._popPanel.remove()},_initUI:function(){var t=$.i18n.prop("func_jrtx_titlename"),n={title:t,width:720,height:450,top:200,left:400,scroll:!0,contentHTML:this._getContentHTML()},r=this._popPanel=new e.ICT.PopPanel(n);r.show()},_initEvts:function(){self=this,this._popPanel.on("popPanelRemove",function(){this._popPanel=null,this.menu.mainmenu.deactiveMenu(this.menuid)},this)},_getContentHTML:function(){var e=$.i18n.prop("func_jrtx_lb_tx"),t=[];return t.push('<TABLE border=0 style="width:700px;height:380px;font-family:Microsoft Yahei;font-size:12px;" cellspacing="0">'),t.push("	<TR>"),t.push('		<TD style="width:100%;height:30px;line-height:30px;text-align:left;vertical-align:middle;padding-left:10px;">'),t.push('			<input type="text" id="jrtx_lb_tx" class="jrtx_input_lb" style="width:270px" value="'+e+'"/>'),t.push("		</TD>"),t.push("	</TR>"),t.push("	<TR>"),t.push('		<TD width=700px height="350px";align=center valign=top>'),t.push('			<div id="jrtx_dialog_event_list" style="width:100%;height:340px;padding-left:10px;padding-right:10px;"></div>'),t.push('			<div id="jrtx_div_page" style="width:100%;height:30px;text-align:right;padding-right:20px;"></div>'),t.push("		</TD>"),t.push("	</TR>"),t.push("</TABLE>"),t.join("")},formatDateNow:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,r=e.getDate()<10?"0"+e.getDate():e.getDate(),i=t+"-"+n+"-"+r;return i},getNewDateTimeBeforHour:function(e){var t=new Date;return t=t.valueOf(),t-=e*60*60*1e3,t=new Date(t),t},formatDateFULL:function(e){var t=e.getFullYear(),n=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,r=e.getDate()<10?"0"+e.getDate():e.getDate(),i=e.getHours()<10?"0"+e.getHours():e.getHours(),s=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),o=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds(),u=t+"-"+n+"-"+r+" "+i+":"+s+":"+o;return u},_eventGetSearchWhere:function(){var e=new Date,t=this.getNewDateTimeBeforHour(24),n=this.formatDateFULL(t),r=this.formatDateFULL(e),i={};return i.timespane=e.getTime().toString(),i.shipidstr="",i.ischeckshipid="0",i.startsj=n,i.endsj=r,i.pagesize=this.pagesize,i.pagenum=this.pagenum,i},_eventSearch:function(e){e&&this._pageInfoInit();var t=$.i18n.prop("func_cdgl_error_msg_getEventInfo"),n=this._eventGetSearchWhere(),r=self.config.getEventListUrl;self.ajax.post(r,n,!0,this,function(e){e.state!=1?this._showErrorMsg(t):this._showEventListSucess(e)},function(e){this._showErrorMsg(t)})},_showEventListSucess:function(e){if(e!=null&&e.rec!=null&&e.rec.length>0){var t=$.i18n.prop("func_jrtx_lb_tx");$("#jrtx_lb_tx").val(t)}else $("#jrtx_lb_tx").val("");this._showDivEventList(e),this.reccount=e.reccount,this.pagecount=e.pagecount,this.pagesize=e.pagesize,this.pagenum=e.pagenum;var n=!0;for(var r=0;r<this.curShowPageLabelAry.length;r++)this.curShowPageLabelAry[r]==this.pagenum&&(n=!1);var i=e.rec;i!=null&&i.length>0&&(n&&this._showDivPageInfo(),this._DivPageNumLabelSetCur())},_showDivEventList:function(e){var t=$.i18n.prop("func_cdgl_datagrid_xh"),n=$.i18n.prop("func_cdgl_datagrid_shipName"),r=$.i18n.prop("func_cdgl_datagrid_time"),i=$.i18n.prop("func_cdgl_datagrid_state"),s=$.i18n.prop("func_cdgl_datagrid_portName"),o=e.rec,u="#e6effe",a='<table style="width:100%;font-family:Microsoft Yahei;font-size:12px;" border="0" cellspacing="0">';if(o!=null&&o.length>0){a=a+'<tr style="background-color:'+u+';width:100%;height:30px;line-height:30px;text-align:left;">',a+='<td style="width:50px;height:100%;text-align:center;vertical-align:middle;">',a+=t,a+="</td>",a+='<td style="width:150px;height:100%;text-align:left;vertical-align:middle;">',a+=n,a+="</td>",a+='<td style="width:80px;height:100%;text-align:left;vertical-align:middle;">',a+="MMSI",a+="</td>",a+='<td style="width:160px;height:100%;text-align:left;vertical-align:middle;">',a+=r,a+="</td>",a+='<td style="width:80px;height:100%;text-align:left;vertical-align:middle;">',a+=i,a+="</td>",a+='<td style="width:180px;height:100%;text-align:left;vertical-align:middle;">',a+=s,a+="</td>",a+="</tr>";for(var f=0;f<o.length;f++){u=="#e6effe"?u="#ffffff":u="#e6effe",a=a+'<tr style="background-color:'+u+';width:100%;height:30px;line-height:30px;text-align:left;">',a+='<td style="width:50px;height:100%;text-align:center;vertical-align:middle;">',a+=(f+1).toString(),a+="</td>",a+='<td style="width:150px;height:100%;text-align:left;vertical-align:middle;">',a+=o[f].ship_name,a+="</td>",a+='<td style="width:80px;height:100%;text-align:left;vertical-align:middle;">',a+=o[f].mmsi,a+="</td>",a+='<td style="width:160px;height:100%;text-align:left;vertical-align:middle;">',a+=o[f].sj_str,a+="</td>",a+='<td style="width:80px;height:100%;text-align:left;vertical-align:middle;">';var l=window.localStorage.getItem("language"),c=o[f].state_name,h="";c=="进港"?h=$.i18n.prop("func_cdgl_datagrid_state_jg"):c=="出港"&&(h=$.i18n.prop("func_cdgl_datagrid_state_cg")),a+=h,a+="</td>",a+='<td style="width:180px;height:100%;text-align:left;vertical-align:middle;">',a+=o[f].port_name,a+="</td>",a+="</tr>"}}else{var p=$.i18n.prop("func_cdgl_msg_tip_event_noseachresult");a+='<tr style="width:100%;height:330px;line-height:330px;text-align:center;">',a+='<td style="width:100%;height:100%;line-height:330px;text-align:center;vertical-align:middle;">',a=a+"<label>"+p+"</label>",a+="</td>",a+="</tr>"}a+="</table>",$("#jrtx_dialog_event_list").html(a)},_pageInfoInit:function(){this.showpagelabelcount=5,this.curShowPageLabelAry=[],this.pagesize=10,this.pagenum=1,this.reccount=0,this.pagecount=0},_showDivPageInfo:function(){this.curShowPageLabelAry=[];var e=this.pagecount-this.pagenum,t=parseInt(this.showpagelabelcount.toString())-parseInt("1");if(e>=t){this.curShowPageLabelAry.push(this.pagenum);for(var n=1;n<this.showpagelabelcount;n++){var r=parseInt(this.pagenum.toString())+parseInt(n.toString());r<=this.pagecount&&this.curShowPageLabelAry.push(r)}}else{var i=parseInt(this.pagecount.toString()),s=parseInt(this.pagecount.toString())-parseInt(this.showpagelabelcount.toString())+parseInt("1");s<=0&&(s=1);for(var o=s;o<=i;o++)this.curShowPageLabelAry.push(o)}var u=$.i18n.prop("func_cdgl_page_first"),a=$.i18n.prop("func_cdgl_page_last"),f=$.i18n.prop("func_cdgl_page_previous"),l=$.i18n.prop("func_cdgl_page_next"),c='<label id="divPageFirst" class="jrtx_page_first"  onclick="self._divPageClickFirst();">'+u+"</label>";c+="<label>&nbsp</label>";for(var h=0;h<this.curShowPageLabelAry.length;h++)c=c+'<label class="jrtx_page_numlabel_noselect" id="divPageNumLabel_'+this.curShowPageLabelAry[h]+'" onclick="self._divPageClickNum('+this.curShowPageLabelAry[h]+');">'+this.curShowPageLabelAry[h]+"</label>";c+="<label>&nbsp</label>",c=c+'<label id="divPageLast" class="jrtx_page_last"  onclick="self._divPageClickLast();">'+a+"</label>",c+="<label>&nbsp</label>",c=c+'<label id="divPageLast" class="jrtx_page_pre"  onclick="self._divPageClickPre();">'+f+"</label>",c+="<label>&nbsp</label>",c=c+'<label id="divPageLast" class="jrtx_page_next" onclick="self._divPageClickNext();">'+l+"</label>",$("#jrtx_div_page").html(c)},_DivPageNumLabelSetCur:function(){for(var e=0;e<this.curShowPageLabelAry.length;e++)this.curShowPageLabelAry[e]==this.pagenum?$("#divPageNumLabel_"+this.curShowPageLabelAry[e]).attr("class","jrtx_page_numlabel_select"):$("#divPageNumLabel_"+this.curShowPageLabelAry[e]).attr("class","jrtx_page_numlabel_noselect")},_divPageClickFirst:function(){if(this.pagenum<=1)return;this.pagenum=1,this._eventSearch(!1)},_divPageClickPre:function(){if(this.pagenum<=1)return;this.pagenum=parseInt(this.pagenum.toString())-parseInt("1"),this._eventSearch(!1)},_divPageClickNum:function(e){this.pagenum=e,this._eventSearch(!1)},_divPageClickNext:function(){if(this.pagenum>=this.pagecount)return;this.pagenum=parseInt(this.pagenum.toString())+parseInt("1"),this._eventSearch(!1)},_divPageClickLast:function(){if(this.pagenum>=this.pagecount)return;this.pagenum=this.pagecount,this._eventSearch(!1)},_showMsg:function(t){e.ict.app.util.dialog.warn($.i18n.prop("dialog_alert_title"),t)},_showErrorMsg:function(t){e.ict.app.util.dialog.error($.i18n.prop("dialog_alert_title"),t)}})})});