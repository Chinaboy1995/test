define("func/areaflow",["leaflet","echarts","func/base","control/draw","control/loading","data/ajax","plugins/mcscroll","control/panel"],function(e,t){e.ICT.Func.add("AreaFlow",{Class:e.Class.extend({_data:{historyChk:!1,realtimeChk:!1,startTime:null,endTime:null},initialize:function(){this.ajax=new e.ICT.Ajax,this.ajax.setTimeout(6e5),this.ictmap=e.ict.app.ictmap,this.dateUtil=e.ict.app.util.dateTime,this.menu=e.ict.app.menu,this.menuid="ict_menu_main_qyll",this.config=Project_ParamConfig.StasticConfig,this._container=null,this._popPanel=null,this._drawPopPanel=null,this._resultPopPanel=null,this._layer=null,this._layerType=null},start:function(){this.menu.mainmenu.deactiveMenuExceptOne(this.menuid),this.menu.mainmenu.disableMenuExceptOne(this.menuid);if(!e.ICT.Func.UserLogin.getInstance().isLogin()){e.ICT.Func.UserLogin.getInstance().alertLoginDialog(),this.menu.mainmenu.deactiveMenu(this.menuid);return}if(this._container||this._popPanel)return;this._initUi(),this._initEvts(),this._container.find("input[type=radio]").eq(0).click()},stop:function(){this.menu.mainmenu.enableMenu(),this.menu.mainmenu.deactiveMenu(this.menuid),this.ictmap.deactivate(),this._popPanel&&this._popPanel.remove(!1),this._layer&&this._layer.remove(),this._drawPopPanel&&this._drawPopPanel.remove(),this._resultPopPanel&&this._resultPopPanel.remove(!1),this._container=null,this._popPanel=null,this._drawPopPanel=null,this._resultPopPanel=null,this._layer=null,this._layerType=null},getContentHTML:function(){var e=[];return e.push('<div class="areaflowAnalysisContainer">'),e.push('<p class="common_draw_title">绘制区域：</p>'),e.push('<div class="drawDiv">'),e.push('<input type="radio" name="drawRadio" value="circle"><img src="themes/images/frame/ico_circle.png">&nbsp<label class="draw_circle_txt common_draw_circle">圆形</label>&nbsp&nbsp'),e.push('<input type="radio" name="drawRadio" value="rect"><img src="themes/images/frame/ico_rect.png">&nbsp<label class="draw_rect_txt common_draw_rect">矩形</label>'),e.push("</div>"),e.push('<div class="timeDiv">'),e.push('<label class="common_time_info1">时间:</label> <input type="text" class="Wdate startTime">'),e.push('&nbsp<label class="common_time_info2">至</label>&nbsp<input type="text" class="Wdate endTime">'),e.push("</div>"),e.push('<p class="msg"></p>'),e.push('<div class="btnDiv">'),e.push('<button type="button" class="okBtn func_qyll_okbtn">查询</button>'),e.push("</div>"),e.push("</div>"),e.join("")},_initUi:function(){var t={title:$.i18n.prop("func_qyll_title"),width:400,height:270,left:100,top:200},n=this._container=$(this.getContentHTML());t.contentHTML=n;var r=this._popPanel=new e.ICT.PopPanel(t);r.on("popPanelRemove",function(){this._popPanel=this._container=null,this.stop()},this),r.show()},_initEvts:function(){var t=this;t._container.find(".func_qyll_okbtn").html($.i18n.prop("func_qyll_okbtn")),t._container.find(".common_draw_title").html($.i18n.prop("common_draw_title")),t._container.find(".common_draw_circle").html($.i18n.prop("common_draw_circle")),t._container.find(".common_draw_rect").html($.i18n.prop("common_draw_rect")),t._container.find(".common_time_info1").html($.i18n.prop("common_time_info1")),t._container.find(".common_time_info2").html($.i18n.prop("common_time_info2")),t._container.find("input[type=radio]").on("click",function(){t._layer&&t._layer.remove(),t.__drawPopPanel&&t._drawPopPanel.remove();var n=$(this).val();n=="circle"?t.ictmap.activate(e.ICT.MapMouseState.CIRCLE,t._drawCallback,null,t):n=="rect"&&t.ictmap.activate(e.ICT.MapMouseState.RECTANGLE,t._drawCallback,null,t)}),t._container.find(".Wdate").on("focus",function(){var e={readOnly:!0,dateFmt:"yyyy-MM-dd HH",isShowClear:!1,startDate:"%y-%M-01 00:00:00",alwaysUseStartDate:!0,maxDate:"%y-%M-%d %H:%m:%s",lang:window.localStorage.getItem("language")==="en"?"en":"zh-cn"};WdatePicker(e)});var n=t.dateUtil.getNewDateTimeBeforHour(24);n=t.dateUtil.formatDateH(n);var r=t.dateUtil.formatDateH(new Date);t._container.find(".Wdate.startTime").val(n),t._container.find(".Wdate.endTime").val(r),t._container.find(".okBtn").on("click",function(){var n=t._container.find(".msg"),r=t._container.find(".startTime").val(),i=t._container.find(".endTime").val();n.html("");if(!t.ictmap.map.hasLayer(t._layer)){n.html($.i18n.prop("common_draw_error1"));return}var s=t.dateUtil.checkStrartEndTime(r+":00:00",i+":00:00",t.config.timerange);if(!s.result){n.html(s.msg);return}r=e.ict.app.util.dateTime.getCusUnixTime(r+":00:00"),i=e.ict.app.util.dateTime.getCusUnixTime(i+":00:00"),t._popPanel.close();var o={},u=t._layer.getBounds();o.ldlon=u.getSouthWest().lng,o.ldlat=u.getSouthWest().lat,o.rulon=u.getNorthEast().lng,o.rulat=u.getNorthEast().lat,o.startTime=r,o.endTime=i,t.analysis(o)}),t._container.find(".cancelBtn").on("click",function(){t.stop()})},_drawCallback:function(t){var n=this._layer=t.layer,r=this._layerType=t.layerType;this._drawPopPanel&&this._drawPopPanel.remove(),this._drawPopPanel=new e.ICT.DrawPopPanel(n,r),this._drawPopPanel.on("popPanelRemove",function(){this._drawPopPanel=null},this),this._drawPopPanel.on("CancelDraw",function(e){this._layer=null},this),this._drawPopPanel.show(),this.ictmap.map.addLayer(n),n.editing&&(n.editing.enable(),n.on("edit",function(){this._drawPopPanel.updateContent()},this))},analysis:function(t){var n={title:$.i18n.prop("func_qyll_title"),width:800,height:600,contentHTML:this.getResultHTML()},r=this._resultPopPanel=new e.ICT.PopPanel(n);r.on("popPanelRemove",function(){this._resultPopPanel=null,this.stop()},this),r.show(),this.sendAjax(t)},_initResEvts:function(){var e=this._resultPopPanel.getContainer().find(".areaflow_stastic_container"),t=this;e.find(".nav_titleNav>li").on("click",function(){$(this).addClass("active").siblings().removeClass("active");var t=$(this).data("info");t==="chart"?(e.find(".stasticChartDiv").css("display","block"),e.find(".stasticTableDiv").css("display","none")):(e.find(".stasticChartDiv").css("display","none"),e.find(".stasticTableDiv").css("display","block"))}),e.find(".stastic_table_enter").mCustomScrollbar({theme:"minimal-dark"}),e.find(".stastic_table_out").mCustomScrollbar({theme:"minimal-dark"})},sendAjax:function(t){this._loading=(new e.ICT.Control.Loading).addTo(this._resultPopPanel.getContainer().find(".container-content")),this._loading.show();var n=this.config.areaflowUrl;this.ajax.post(n,t,!0,this,function(t){this._loading.hide(),t.state!==1?(console.error(t.msg.error),e.ict.app.util.dialog.error($.i18n.prop("dialog_alert_title"),$.i18n.prop("func_qyll_error1"))):(this.showStasticRes(t),this._initResEvts())},function(t){this._loading.hide(),e.ict.app.util.dialog.error($.i18n.prop("dialog_alert_title"),$.i18n.prop("func_qyll_error1"))})},showStasticRes:function(e){var t=this._resultPopPanel.getContainer().find(".stasticChartDiv"),n=this._resultPopPanel.getContainer().find(".stasticTableDiv");t.html(this.getstasticChartHtml(e)),n.html(this.getstasticTableHtml(e)),this.initecharts(e)},getstasticChartHtml:function(e){var t=$.i18n.prop("func_qyll_qysr"),n=$.i18n.prop("func_qyll_qysl"),r=[];return r.push('<div class="stasticChartDiv" style="display:block;">'),r.push("<p>"+t+"</p>"),r.push('<div class="stastic_chart_enter"></div>'),r.push("<p>"+n+"</p>"),r.push('<div class="stastic_chart_out"></div>'),r.push("</div>"),r.join("")},getstasticTableHtml:function(e){var t=e.msg.shipList[0].areacountlist,n=e.msg.shipList[1].areacountlist,r=e.msg.shipList[0].enterareacount,i=e.msg.shipList[1].leaveareacount,s=$.i18n.prop("func_qyll_qysrcount",r),o=$.i18n.prop("func_qyll_qyslcount",i),u=$.i18n.prop("common_ship_country2"),a=$.i18n.prop("func_filter_shiptype_1"),f=$.i18n.prop("func_filter_shiptype_3"),l=$.i18n.prop("func_filter_shiptype_6"),c=$.i18n.prop("func_filter_shiptype_5"),h=$.i18n.prop("func_filter_shiptype_7"),p=$.i18n.prop("func_filter_shiptype_4"),d=$.i18n.prop("func_filter_shiptype_100"),v=[];v.push('<div class="stasticTableDiv" style="display:none;">'),v.push("<p>"+s+"</p>"),v.push('<div class="stastic_table_enter">'),v.push("<table>"),v.push("<thead><tr><th>"+u+"</th><th>"+a+"</th><th>"+f+"</th><th>"+l+"</th><th>"+c+"</th><th>"+h+"</th><th>"+p+"</th><th>"+d+"</th></tr></thead>"),v.push("<tbody>");for(var m=0,g=t.length;m<g;m++){var y=t[m],b=this.ictmap.realtarget.convertNameToKey(y.co.trim(),"shipflag"),w=window.localStorage.getItem("language")==="en"?y.co_English:y.co;v.push("<tr>"),v.push('<td><img src="themes/images/filterdisplay/country_'+b+'.png">'+w+"</td>"),v.push("<td>"+y.tc1+"</td>"),v.push("<td>"+y.tc3+"</td>"),v.push("<td>"+y.tc6+"</td>"),v.push("<td>"+y.tc5+"</td>"),v.push("<td>"+y.tc7+"</td>"),v.push("<td>"+y.tc4+"</td>"),v.push("<td>"+y.tc100+"</td>"),v.push("</tr>"),m<g-1&&v.push('<tr class="splitTr"><td colspan="8">&nbsp</td></tr>')}v.push("</tbody>"),v.push("</table>"),v.push("</div>"),v.push("<p>"+o+"</p>"),v.push('<div class="stastic_table_out">'),v.push("<table>"),v.push("<thead><tr><th>"+u+"</th><th>"+a+"</th><th>"+f+"</th><th>"+l+"</th><th>"+c+"</th><th>"+h+"</th><th>"+p+"</th><th>"+d+"</th></tr></thead>"),v.push("<tbody>");for(var m=0,g=n.length;m<g;m++){var E=n[m],b=this.ictmap.realtarget.convertNameToKey(E.co.trim(),"shipflag"),w=window.localStorage.getItem("language")==="en"?E.co_English:E.co;v.push("<tr>"),v.push('<td><img src="themes/images/filterdisplay/country_'+b+'.png">'+w+"</td>"),v.push("<td>"+E.tc1+"</td>"),v.push("<td>"+E.tc3+"</td>"),v.push("<td>"+E.tc6+"</td>"),v.push("<td>"+E.tc5+"</td>"),v.push("<td>"+E.tc7+"</td>"),v.push("<td>"+E.tc4+"</td>"),v.push("<td>"+E.tc100+"</td>"),v.push("</tr>"),m<g-1&&v.push('<tr class="splitTr"><td colspan="8">&nbsp</td></tr>')}return v.push("</tbody>"),v.push("</table>"),v.push("</div>"),v.push("</div>"),v.join("")},initecharts:function(e){var n=this._resultPopPanel.getContainer(),r={},i={},s=e.msg.shipList[0].areacountlist,o=e.msg.shipList[1].areacountlist;for(var u=0,a=s.length;u<a;u++){var f=s[u];r[f.co]=[],r[f.co].push(f.tc1),r[f.co].push(f.tc3),r[f.co].push(f.tc6),r[f.co].push(f.tc5),r[f.co].push(f.tc7),r[f.co].push(f.tc4),r[f.co].push(f.tc100)}for(var u=0,a=o.length;u<a;u++){var l=o[u];i[l.co]=[],i[l.co].push(l.tc1),i[l.co].push(l.tc3),i[l.co].push(l.tc6),i[l.co].push(l.tc5),i[l.co].push(l.tc7),i[l.co].push(l.tc4),i[l.co].push(l.tc100)}this.echart_enter=t.init(n.find(".stastic_chart_enter").get(0)),this.echart_out=t.init(n.find(".stastic_chart_out").get(0));var c=this.getChartOption(r),h=this.getChartOption(i);this.echart_enter.setOption(c,!0),this.echart_out.setOption(h,!0)},getChartOption:function(e){var t=$.i18n.prop("func_filter_shipflag_1"),n=$.i18n.prop("func_filter_shipflag_5"),r=$.i18n.prop("func_filter_shipflag_2"),i=$.i18n.prop("func_filter_shipflag_3"),s=$.i18n.prop("func_filter_shipflag_4"),o=$.i18n.prop("func_filter_shipflag_100"),u=$.i18n.prop("func_filter_shiptype_1"),a=$.i18n.prop("func_filter_shiptype_3"),f=$.i18n.prop("func_filter_shiptype_6"),l=$.i18n.prop("func_filter_shiptype_5"),c=$.i18n.prop("func_filter_shiptype_7"),h=$.i18n.prop("func_filter_shiptype_4"),p=$.i18n.prop("func_filter_shiptype_100"),d={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:[t,n,r,i,s,o]},xAxis:[{type:"category",data:[u,a,f,l,c,h,p]}],yAxis:[{type:"value"}],color:["#065F89","#0A7CB0","#0FA0E3","#3AD3FF","#6DDEFE","#BDF1FF"],series:[{name:t,type:"bar",barWidth:10,stack:"stastic",data:e["中国"]},{name:n,type:"bar",stack:"stastic",data:e["俄罗斯"]},{name:r,type:"bar",stack:"stastic",data:e["英国"]},{name:i,type:"bar",stack:"stastic",data:e["法国"]},{name:s,type:"bar",stack:"stastic",data:e["美国"]},{name:o,type:"bar",stack:"stastic",data:e["其他"]}]};return d},getResultHTML:function(){var e=$.i18n.prop("port_static_chart"),t=$.i18n.prop("port_static_table"),n=[];return n.push('<div class="areaflow_stastic_container">'),n.push('<div class="titleDiv">'),n.push('<ul class="nav nav_titleNav">'),n.push('<li class="active" data-info="chart"><a href="#" >'+e+"</a></li>"),n.push('<li data-info="table"><a href="#">'+t+"</a></li>"),n.push("</ul>"),n.push("</div>"),n.push('<div class="contentDiv">'),n.push('<div class="stasticChartDiv" style="display:block;"></div>'),n.push('<div class="stasticTableDiv" style="display:none;"></div>'),n.push("</div>"),n.push("</div>"),n.join("")}})})});