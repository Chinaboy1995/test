/*
 * JQuery zTree 2.3
 * http://code.google.com/p/jquerytree/
 *
 * Copyright (c) 2010 Hunter.z
 *
 * Date: 2011-01-04
 *
 */

define("plugins/ztree",["jquery"],function(){(function(e){function kb(t,n){n.unbind(ka),n.bind(ka,function(e,n,r){typeof t.callback.click=="function"&&t.callback.click(e,n,r)}),n.unbind(la),n.bind(la,function(e,n,r){typeof t.callback.change=="function"&&t.callback.change(e,n,r)}),n.unbind(ma),n.bind(ma,function(e,n,r){typeof t.callback.rename=="function"&&t.callback.rename(e,n,r)}),n.unbind(na),n.bind(na,function(e,n,r){typeof t.callback.remove=="function"&&t.callback.remove(e,n,r)}),n.unbind(oa),n.bind(oa,function(e,n,r){typeof t.callback.drag=="function"&&t.callback.drag(e,n,r)}),n.unbind(Z),n.bind(Z,function(e,n,r,i,s){typeof t.callback.drop=="function"&&t.callback.drop(e,n,r,i,s)}),n.unbind(pa),n.bind(pa,function(e,n,r){typeof t.callback.expand=="function"&&t.callback.expand(e,n,r)}),n.unbind(qa),n.bind(qa,function(e,n,r){typeof t.callback.collapse=="function"&&t.callback.collapse(e,n,r)}),n.unbind(ra),n.bind(ra,function(e,n,r,i){typeof t.callback.asyncSuccess=="function"&&t.callback.asyncSuccess(e,n,r,i)}),n.unbind(sa),n.bind(sa,function(e,n,r,i,s,o){typeof t.callback.asyncError=="function"&&t.callback.asyncError(e,n,r,i,s,o)}),e("#"+t.treeObjId).bind("contextmenu",function(n){var r=e(n.target);r=ta(t,r);var i=!0;return typeof t.callback.beforeRightClick=="function"&&(i=t.callback.beforeRightClick(t.treeObjId,r)),i&&typeof t.callback.rightClick=="function"?(t.callback.rightClick(n,t.treeObjId,r),!1):typeof t.callback.rightClick!="function"}),e("#"+t.treeObjId).bind("mouseup",function(n){var r=e(n.target);r=ta(t,r);var i=!0;return typeof t.callback.beforeMouseUp=="function"&&(i=t.callback.beforeMouseUp(t.treeObjId,r)),i&&typeof t.callback.mouseUp=="function"&&t.callback.mouseUp(n,t.treeObjId,r),!0}),e("#"+t.treeObjId).bind("mousedown",function(n){var r=e(n.target);r=ta(t,r);var i=!0;return typeof t.callback.beforeMouseDown=="function"&&(i=t.callback.beforeMouseDown(t.treeObjId,r)),i&&typeof t.callback.mouseDown=="function"&&t.callback.mouseDown(n,t.treeObjId,r),!0})}function ta(t,n){var r;r=e(n);if(r.attr("id")==t.treeObjId)r=null;else{for(;!r.is("li")&&r.attr("id")!=t.treeObjId;)r=r.parent();r=r.attr("id"),r=$(t,r)}return r}function S(e,t,n,r){if(n)for(var i=0;i<n.length;i++){var s=n[i];s.level=t,s.tId=e.treeObjId+"_"+ ++ua,s.parentNode=r,s[e.checkedCol]=s[e.checkedCol]==1,s.checkedOld=s[e.checkedCol],s.check_Focus=!1,s.check_True_Full=!0,s.check_False_Full=!0,s.editNameStatus=!1,s.isFirstNode=(r?r:e.root)[e.nodesCol].length==n.length&&i==0,s.isLastNode=i==n.length-1,s[e.nodesCol]&&s[e.nodesCol].length>0?(s.open=s.open?!0:!1,s.isParent=!0,Qa(e,s),S(e,t+1,s[e.nodesCol],s)):(s.isParent=s.isParent?!0:!1,Qa(e,s),e.checkable&&i==n.length-1&&aa(e,s))}}function Qa(t,n){var i=n.parentNode;i=i?e("#"+n.parentNode.tId+u):e("#"+t.treeObjId),i.append("<li id='"+n.tId+"' class='tree-node'><button type=\"button\" id='"+n.tId+w+"' title='' onfocus='this.blur();'></button><a id='"+n.tId+o+"' onclick=\""+(n.click||"")+'" ><button type="button" id=\''+n.tId+r+"' title='' onfocus='this.blur();'></button><span id='"+n.tId+K+"'></span></a><ul id='"+n.tId+u+"'></ul></li>"),i=e("#"+n.tId+w);var s=e("#"+n.tId+o);e("#"+n.tId+K);var a=e("#"+n.tId+u),f=e("#"+n.tId+r);Ra(t,n),H(t,n),a.css({display:n.open?"block":"none"}),n.isParent&&(i.bind("click",{treeObjId:t.treeObjId,treeNode:n},ba),s.bind("dblclick",{treeObjId:t.treeObjId,treeNode:n},ba)),s.bind("click",function(){var r=!0;typeof t.callback.beforeClick=="function"&&(r=t.callback.beforeClick(t.treeObjId,n)),r!=0&&(window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),O(t,n),e("#"+t.treeObjId).trigger(ka,[t.treeObjId,n]))}),f.bind("mousedown",function(){n.editNameStatus=!1});if(t.checkable){i.after("<BUTTON type='BUTTON' ID='"+n.tId+I+"' onfocus='this.blur();' ></BUTTON>");var l=e("#"+n.tId+I);t.checkStyle==P&&t.checkRadioType==va&&n[t.checkedCol]&&(t.checkRadioCheckedList=t.checkRadioCheckedList.concat([n])),A(t,l,n),l.bind("click",function(){var r=!0;typeof t.callback.beforeChange=="function"&&(r=t.callback.beforeChange(t.treeObjId,n)),r!=0&&(n[t.checkedCol]=!n[t.checkedCol],Sa(t,n),A(t,l,n),T(t,n),e("#"+t.treeObjId).trigger(la,[t.treeObjId,n]))}),l.bind("mouseover",function(){n.checkboxFocus=!0,A(t,l,n)}),l.bind("mouseout",function(){n.checkboxFocus=!1,A(t,l,n)})}Ta(n),Ua(t,n),s.hover(function(){Va(t,n)},function(){t.curTreeNode!=n&&ca(t,n)}),s.bind("mousedown",function(i){if(i.button!=2&&!!t.editable){var s=document,a,f,l,c=!1,h=t,p=null,d=null,v=null,m=x,g=i.clientX,y=i.clientY,E=(new Date).getTime();e(s).mousemove(function(r){if(n.editNameStatus)return!0;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();if(t.dragStatus==0&&Math.abs(g-r.clientX)<Xa&&Math.abs(y-r.clientY)<Xa)return!0;e("body").css("cursor","pointer"),e("#"+n.tId+w),t.dragStatus==0&&n.isParent&&n.open&&(B(t,n,!n.open),t.dragNodeShowBefore=!0);if(t.dragStatus==0){t.dragStatus=-1;var i=!0;typeof t.callback.beforeDrag=="function"&&(i=t.callback.beforeDrag(t.treeObjId,n));if(i==0)return;t.dragStatus=1,Ya(!0),O(t,n),ca(t,n),i=e("#"+n.tId).clone(),i.attr("id",n.tId+"_tmp"),i.css("padding","0"),i.children("#"+n.tId+o).removeClass(wa),i.children("#"+n.tId+u).css("display","none"),a=e("<ul class='zTreeDragUL'></ul>").append(i),a.attr("id",n.tId+u+"_tmp"),a.addClass(e("#"+t.treeObjId).attr("class")),a.appendTo("body"),f=e("<button class='tmpzTreeMove_arrow'></button>"),f.attr("id","zTreeMove_arrow_tmp"),f.appendTo("body"),e("#"+t.treeObjId).trigger(oa,[t.treeObjId,n])}if(t.dragStatus==1&&f.attr("id")!=r.target.id){l&&(l.removeClass(xa),v&&e("#"+v+o,l).removeClass(ya)),v=l=null,c=!1,h=t;for(var S in G)G[S].editable&&G[S].treeObjId!=t.treeObjId&&(r.target.id==G[S].treeObjId||e(r.target).parents("#"+G[S].treeObjId).length>0)&&(c=!0,h=G[S]);S=e(s).scrollTop(),i=e(s).scrollLeft();var T=h.treeObj.offset(),N=h.treeObj.get(0).scrollHeight,C=h.treeObj.get(0).scrollWidth,k=r.clientY+S-T.top,A=h.treeObj.height()+T.top-r.clientY-S,M=r.clientX+i-T.left;T=h.treeObj.width()+T.left-r.clientX-i,k=k<10&&k>-5,A=A<10&&A>-5,M=M<10&&M>-5,T=T<10&&T>-5;var _=k&&h.treeObj.scrollTop()<=0;N=A&&h.treeObj.scrollTop()+h.treeObj.height()+10>=N;var D=M&&h.treeObj.scrollLeft()<=0;C=T&&h.treeObj.scrollLeft()+h.treeObj.width()+10>=C;if(r.target.id&&h.treeObj.find("#"+r.target.id).length>0){for(var P=e("#"+r.target.id);!P.is("li")&&P.attr("id")!=h.treeObjId;)P=P.parent();var H=!1;n.parentNode&&P.attr("id")!=n.tId&&e("#"+n.tId).find("#"+P.attr("id")).length==0?H=!0:n.parentNode==null&&P.attr("id")!=n.tId&&e("#"+n.tId).find("#"+P.attr("id")).length==0&&(H=!0),H&&r.target.id&&(r.target.id==P.attr("id")+o||e(r.target).parents("#"+P.attr("id")+o).length>0)&&(l=P,v=P.attr("id"),e("#"+v+o,l).addClass(ya))}if(r.target.id==h.treeObjId||e(r.target).parents("#"+h.treeObjId).length>0)!l&&(_||N||D||C)&&(c||!c&&n.parentNode!=null)&&(l=h.treeObj,l.addClass(xa)),k?h.treeObj.scrollTop(h.treeObj.scrollTop()-10):A&&h.treeObj.scrollTop(h.treeObj.scrollTop()+10),M?h.treeObj.scrollLeft(h.treeObj.scrollLeft()-10):T&&h.treeObj.scrollLeft(h.treeObj.scrollLeft()+10),l&&l!=h.treeObj&&l.offset().left<h.treeObj.offset().left&&h.treeObj.scrollLeft(h.treeObj.scrollLeft()+l.offset().left-h.treeObj.offset().left);a.css({top:r.clientY+S+3+"px",left:r.clientX+i+3+"px"}),C=k=0;if(l&&l.attr("id")!=h.treeObjId){k=e("#"+n.tId).prev().attr("id")==l.attr("id"),C=e("#"+n.tId).next().attr("id")==l.attr("id"),i=e("#"+v+o,l),r=(r.clientY+S-i.offset().top)/i.height(),r<.25&&r>=-0.2&&!C?(k=1-f.width(),C=0-f.height()/2,m=W):r>.75&&r<=1.2&&!k?(k=1-f.width(),C=i.height()-f.height()/2,m=da):(k=5-f.width(),C=0,m=x),f.css({display:"block",top:i.offset().top+C+"px",left:i.offset().left+k+"px"});if(p!=v||d!=m)E=(new Date).getTime();m==x&&(window.moveTimer=setTimeout(function(){if(m==x){var e=$(h,v);e&&e.isParent&&!e.open&&(new Date).getTime()-E>500&&Ba(h,e)}},600))}else m=x,f.css({display:"none"}),window.moveTimer&&clearTimeout(window.moveTimer);p=v,d=m}return!1}),e(s).mouseup(function(){this.moveTimer&&clearTimeout(this.moveTimer),d=p=null,e(s).unbind("mousemove"),e(s).unbind("mouseup"),e("body").css("cursor","auto"),l&&(l.removeClass(xa),v&&e("#"+v+o,l).removeClass(ya)),Ya(!1);if(t.dragStatus!=0){t.dragStatus=0,n.isParent&&t.dragNodeShowBefore&&!n.open&&(B(t,n,!n.open),t.dragNodeShowBefore=!1),a&&a.remove(),f&&f.remove(),l&&v&&n.parentNode&&v==n.parentNode.tId&&m==x&&(l=null);if(l){var i=v==null?null:$(h,v),u=!0;typeof h.callback.beforeDrop=="function"&&(u=h.callback.beforeDrop(h.treeObjId,n,i,m)),u!=0&&(c?(Ca(t,n),fa(h,null,[n],!1),Da(h,i,n,m),O(h,n)):Da(h,i,n,m),e("#"+n.tId+r).focus().blur(),e("#"+t.treeObjId).trigger(Z,[h.treeObjId,n,i,m]))}else e("#"+t.treeObjId).trigger(Z,[t.treeObjId,null,null,null])}}),i.preventDefault&&i.preventDefault()}}),typeof t.addDiyDom=="function"&&t.addDiyDom(t.treeObjId,n)}function pb(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}function Ya(t){for(;ga.length>0;)ga[0].remove(),ga.shift();if(t){t=e("iframe");for(var n=0;n<t.length;n++){var r=t.get(n),i;i=Array(2),oRect=r.getBoundingClientRect(),i[0]=oRect.left,i[1]=oRect.top,i=i,r=e("<div id='zTreeMask_"+n+"' class='zTreeMask' style='top:"+i[1]+"px; left:"+i[0]+"px; width:"+r.offsetWidth+"px; height:"+r.offsetHeight+"px;'></div>"),r.appendTo("body"),ga.push(r)}}}function Ra(t,n){e("#"+n.tId+K).text(n[t.nameCol])}function Ta(t){e("#"+t.tId+o).attr("target",t.target||"_blank")}function Ua(t,n){var r=e("#"+n.tId+o);n.url&&!t.editable?r.attr("href",n.url):r.removeAttr("href")}function H(t,n){if(n){var i=e("#"+n.tId+w);e("#"+n.tId+o);var s=e("#"+n.tId+u),a=e("#"+n.tId+r);i.attr("class","switch"),t.showLine?(n.level==0&&n.isFirstNode&&n.isLastNode?i.attr("class","switch_"+Ea):n.level==0&&n.isFirstNode?i.attr("class","switch_"+Fa):n.isLastNode?i.attr("class","switch_"+ha):i.attr("class","switch_"+Za),n.isLastNode?s.removeClass(Ga):s.addClass(Ga)):i.attr("class","switch_"+$a),a.attr("class",n.iconSkin?n.iconSkin:""),n.isParent?(s=n.open?"_"+M:"_"+N,i.attr("class",i.attr("class")+s),a.addClass("ico"+s)):(i.attr("class",i.attr("class")+"_"+J),a.addClass("ico_"+J)),n.icon?a.attr("style","background:url("+n.icon+") 0 0 no-repeat;"):a.attr("style","")}}function F(e,t){if(e){var n=e.attr("class");if(n!=undefined){n=n.split("_");switch(t){case Ea:case Fa:case Za:case ha:case $a:n[1]=t;break;case M:case N:case J:n[2]=t}e.attr("class",n.join("_"))}}}function R(e,t){if(e){var n=e.attr("class");if(n!=undefined){n=n.split("_");switch(t){case M:case N:case J:n[1]=t}e.attr("class",n.join("_"))}}}function Va(e,t){e.dragStatus==0&&(t.isHover=!0,e.editable&&(qb(e,t),rb(e,t)),typeof e.addHoverDom=="function"&&e.addHoverDom(e.treeObjId,t))}function ca(t,n){n.isHover=!1,e("#"+n.tId+ia).unbind().remove(),e("#"+n.tId+X).unbind().remove(),typeof t.removeHoverDom=="function"&&t.removeHoverDom(t.treeObjId,n)}function qb(t,n){if(!(n.editNameStatus||e("#"+n.tId+ia).length>0)){var r=t.edit_renameBtn;typeof t.edit_renameBtn=="function"&&(r=t.edit_renameBtn(n)),r&&(e("#"+n.tId+o),e("#"+n.tId+K).after("<button type='button' class='edit' id='"+n.tId+ia+"' title='' onfocus='this.blur();' style='display:none;'></button>"),e("#"+n.tId+ia).bind("click",function(){var e=!0;typeof t.callback.beforeRename=="function"&&(e=t.callback.beforeRename(t.treeObjId,n));if(e!=0)return ca(t,n),n.editNameStatus=!0,O(t,n),!1}).bind("mousedown",function(){return!0}).show())}}function rb(t,n){if(!(!t.edit_removeBtn||e("#"+n.tId+X).length>0)){var r=t.edit_removeBtn;typeof t.edit_removeBtn=="function"&&(r=t.edit_removeBtn(n)),r&&(e("#"+n.tId+o).append("<button type='button' class='remove' id='"+n.tId+X+"' title='' onfocus='this.blur();' style='display:none;'></button>"),e("#"+n.tId+X),e("#"+n.tId+X).bind("click",function(){var r=!0;typeof t.callback.beforeRemove=="function"&&(r=t.callback.beforeRemove(t.treeObjId,n));if(r!=0)return Ca(t,n),e("#"+t.treeObjId).trigger(na,[t.treeObjId,n]),!1}).bind("mousedown",function(){return!0}).show())}}function Sa(t,n){if(t.checkStyle==P){if(n[t.checkedCol])if(t.checkRadioType==va){for(var r=t.checkRadioCheckedList.length-1;r>=0;r--){var i=t.checkRadioCheckedList[r];i[t.checkedCol]=!1,t.checkRadioCheckedList.splice(r,1),A(t,e("#"+i.tId+I),i),i.parentNode!=n.parentNode&&T(t,i)}t.checkRadioCheckedList=t.checkRadioCheckedList.concat([n])}else{r=n.parentNode?n.parentNode:t.root;for(var s=0;s<r[t.nodesCol].length;s++)i=r[t.nodesCol][s],i[t.checkedCol]&&i!=n&&(i[t.checkedCol]=!1,A(t,e("#"+i.tId+I),i))}else if(t.checkRadioType==va)for(r=0;r<t.checkRadioCheckedList.length;r++)if(n==t.checkRadioCheckedList[r]){t.checkRadioCheckedList.splice(r,1);break}}else n[t.checkedCol]&&t.checkType.Y.indexOf("s")>-1&&(ja(t,n,!0),Ha(t,n)),n[t.checkedCol]&&t.checkType.Y.indexOf("p")>-1&&Ia(t,n,!0),!n[t.checkedCol]&&t.checkType.N.indexOf("s")>-1&&(ja(t,n,!1),Ha(t,n)),!n[t.checkedCol]&&t.checkType.N.indexOf("p")>-1&&Ia(t,n,!1)}function A(e,t,n){t&&(t.removeClass(),e=e.checkStyle+"_"+(n[e.checkedCol]?sb:tb)+"_"+(n[e.checkedCol]||e.checkStyle==P?n.check_True_Full?ab:bb:n.check_False_Full?ab:bb),e=n.checkboxFocus?e+"_"+ub:e,t.addClass(vb),t.addClass(e))}function aa(e,t){t&&t.parentNode&&(Ja(e,t.parentNode),aa(e,t.parentNode))}function T(e,t){t[e.nodesCol]&&t[e.nodesCol].length>0?aa(e,t[e.nodesCol][0]):aa(e,t)}function Ha(e,t){if(t&&t[e.nodesCol]){for(var n=0;n<t[e.nodesCol].length;n++)t[e.nodesCol][n][e.nodesCol]&&Ha(e,t[e.nodesCol][n]);Ja(e,t)}}function Ja(t,n){if(n){var r=!0,i=!0;if(n[t.nodesCol])for(var s=0;s<n[t.nodesCol].length;s++){t.checkStyle==P&&(n[t.nodesCol][s][t.checkedCol]||!n[t.nodesCol][s].check_True_Full)?r=!1:t.checkStyle!=P&&n[t.checkedCol]&&(!n[t.nodesCol][s][t.checkedCol]||!n[t.nodesCol][s].check_True_Full)?r=!1:t.checkStyle!=P&&!n[t.checkedCol]&&(n[t.nodesCol][s][t.checkedCol]||!n[t.nodesCol][s].check_False_Full)&&(i=!1);if(!r||!i)break}n.check_True_Full=r,n.check_False_Full=i,r=e("#"+n.tId+I),A(t,r,n)}}function ba(e){var t=G[e.data.treeObjId];e=e.data.treeNode,t.expandTriggerFlag=!0;if(e.open){var n=!0;typeof t.callback.beforeCollapse=="function"&&(n=t.callback.beforeCollapse(t.treeObjId,e));if(n==0){t.expandTriggerFlag=!1;return}}else{n=!0,typeof t.callback.beforeExpand=="function"&&(n=t.callback.beforeExpand(t.treeObjId,e));if(n==0){t.expandTriggerFlag=!1;return}}Ba(t,e)}function Ba(e,t){t.open||t&&t[e.nodesCol]&&t[e.nodesCol].length>0?B(e,t,!t.open):e.async&&!e.editable?Ka(e,t):t&&B(e,t,!t.open)}function Ka(a,b){if(!b||!b.isAjaxing&&!!b.isParent){b&&(b.isAjaxing=!0,e("#"+b.tId+r).attr("class","ico_loading"));for(var c="",d=0;b&&d<a.asyncParam.length;d++)c+=(c.length>0?"&":"")+a.asyncParam[d]+"="+b[a.asyncParam[d]];for(d=0;d<a.asyncParamOther.length;d+=2)c+=(c.length>0?"&":"")+a.asyncParamOther[d]+"="+a.asyncParamOther[d+1];d=a.asyncUrl,typeof a.asyncUrl=="function"&&(d=a.asyncUrl(b)),e.ajax({type:"POST",url:d,data:c,success:function(f){if(!!f&&f.length!=0){var g="";try{g=typeof f=="string"?eval("("+f+")"):f}catch(i){}H(a,b),g&&g!=""?fa(a,b,g,!1):fa(a,b,[],!1),b&&(b.isAjaxing=undefined),e("#"+a.treeObjId).trigger(ra,[a.treeObjId,b,f])}},error:function(t,n,r){a.expandTriggerFlag=!1,H(a,b),b&&(b.isAjaxing=undefined),e("#"+a.treeObjId).trigger(sa,[a.treeObjId,b,t,n,r])}})}}function B(t,n,i,s,o){if(!n||n.open==i)typeof o=="function"&&o();else{t.expandTriggerFlag&&(o=function(){n.open?e("#"+t.treeObjId).trigger(pa,[t.treeObjId,n]):e("#"+t.treeObjId).trigger(qa,[t.treeObjId,n])},t.expandTriggerFlag=!1),i=e("#"+n.tId+w);var a=e("#"+n.tId+r),f=e("#"+n.tId+u);n.isParent?n.open?(F(i,N),R(a,N),n.open=!1,s==0?(f.hide(),typeof o=="function"&&o()):f.hide(t.expandSpeed,o)):(F(i,M),R(a,M),n.open=!0,s==0?(f.show(),typeof o=="function"&&o()):n[t.nodesCol]&&n[t.nodesCol].length>0?f.show(t.expandSpeed,o):typeof o=="function"&&o()):typeof o=="function"&&o()}}function La(e,t,n,r,i){var s=t?t[e.nodesCol]:e.root[e.nodesCol],o=t?!1:r;if(s)for(var u=0;u<s.length;u++)s[u]&&La(e,s[u],n,o);B(e,t,n,r,i)}function Y(e,t,n,r,i){t&&(t.parentNode?(B(e,t,n,r),t.parentNode&&Y(e,t.parentNode,n,r,i)):B(e,t,n,r,i))}function Ia(t,n,r){var i=e("#"+n.tId+I);n[t.checkedCol]=r,A(t,i,n);if(n.parentNode){i=!0;if(!r)for(var s=0;s<n.parentNode[t.nodesCol].length;s++)if(n.parentNode[t.nodesCol][s][t.checkedCol]){i=!1;break}i&&Ia(t,n.parentNode,r)}}function ja(t,n,r){if(n){var i=e("#"+n.tId+I);n!=t.root&&(n[t.checkedCol]=r,A(t,i,n));if(n[t.nodesCol])for(i=0;i<n[t.nodesCol].length;i++)n[t.nodesCol][i]&&ja(t,n[t.nodesCol][i],r)}}function cb(e,t,n){if(n){n.level=t?t.level+1:0;if(n[e.nodesCol])for(t=0;t<n[e.nodesCol].length;t++)n[e.nodesCol][t]&&cb(e,n,n[e.nodesCol][t])}}function fa(t,n,i,s){t.isSimpleData&&(i=Ma(t,i)),n?e("#"+t.treeObjId).find("#"+n.tId).length!=0&&(target_switchObj=e("#"+n.tId+w),target_icoObj=e("#"+n.tId+r),target_aObj=e("#"+n.tId+o),target_ulObj=e("#"+n.tId+u),n.open||(F(target_switchObj,N),R(target_icoObj,N),n.open=!1,target_ulObj.css({display:"none"})),n.isParent||(target_switchObj.unbind("click"),target_switchObj.bind("click",function(){B(t,n,!n.open)}),target_aObj.unbind("dblclick"),target_aObj.bind("dblclick",{treeObjId:t.treeObjId,treeNode:n},ba)),db(t,n,i),S(t,n.level+1,i,n),s||Y(t,n,!0)):(db(t,t.root,i),S(t,0,i,null))}function db(e,t,n){t[e.nodesCol]||(t[e.nodesCol]=[]),t[e.nodesCol].length>0&&(t[e.nodesCol][t[e.nodesCol].length-1].isLastNode=!1,H(e,t[e.nodesCol][t[e.nodesCol].length-1])),t.isParent=!0,t[e.nodesCol]=t[e.nodesCol].concat(n)}function Da(t,n,i,s,a){if(n!=i){var f=i.parentNode==null?t.root:i.parentNode,l=n===null||n==t.root;l&&n===null&&(n=t.root),l&&(s=x);var c=n.parentNode?n.parentNode:t.root;s!=W&&s!=da&&(s=x);var h=-1,p=0,d=null,v=null;if(i.isFirstNode)h=0,f[t.nodesCol].length>1&&(d=f[t.nodesCol][1],d.isFirstNode=!0);else if(i.isLastNode)h=f[t.nodesCol].length-1,d=f[t.nodesCol][h-1],d.isLastNode=!0;else for(var m=0;m<f[t.nodesCol].length;m++)f[t.nodesCol][m].tId==i.tId&&(h=m);h>=0&&f[t.nodesCol].splice(h,1);if(s!=x)for(m=0;m<c[t.nodesCol].length;m++)c[t.nodesCol][m].tId==n.tId&&(p=m);h=!1,s==x?(l?i.parentNode=null:(h=!n.isParent,n.isParent=!0,i.parentNode=n),n[t.nodesCol]||(n[t.nodesCol]=[]),n[t.nodesCol].length>0&&(v=n[t.nodesCol][n[t.nodesCol].length-1],v.isLastNode=!1),n[t.nodesCol].splice(n[t.nodesCol].length,0,i),i.isLastNode=!0,i.isFirstNode=n[t.nodesCol].length==1):n.isFirstNode&&s==W?(c[t.nodesCol].splice(p,0,i),v=n,v.isFirstNode=!1,i.parentNode=n.parentNode,i.isFirstNode=!0,i.isLastNode=!1):n.isLastNode&&s==da?(c[t.nodesCol].splice(p+1,0,i),v=n,v.isLastNode=!1,i.parentNode=n.parentNode,i.isFirstNode=!1,i.isLastNode=!0):(s==W?c[t.nodesCol].splice(p,0,i):c[t.nodesCol].splice(p+1,0,i),i.parentNode=n.parentNode,i.isFirstNode=!1,i.isLastNode=!1),cb(t,i.parentNode,i),e("#"+i.tId+w),e("#"+i.tId+u);var g,y,b;l?p=c=e("#"+t.treeObjId):(c=e("#"+n.tId),g=e("#"+n.tId+w),y=e("#"+n.tId+r),b=e("#"+n.tId+o),p=e("#"+n.tId+u)),s==x?(F(g,M),R(y,M),n.open=!0,p.css({display:"block"}),h&&!l&&(g.unbind("click"),g.bind("click",function(){B(t,n,!n.open)}),b.unbind("dblclick"),b.bind("dblclick",{treeObjId:t.treeObjId,treeNode:n},ba)),p.append(e("#"+i.tId).detach())):s==W?c.before(e("#"+i.tId).detach()):s==da&&c.after(e("#"+i.tId).detach()),H(t,i),f[t.nodesCol].length<1?(f.isParent=!1,s=e("#"+f.tId+u),l=e("#"+f.tId+w),d=e("#"+f.tId+r),F(l,J),R(d,J),s.css("display","none")):d&&H(t,d),v&&H(t,v),t.checkable&&(Ja(t,f),T(t,f),f!=i.parent&&T(t,i)),Y(t,i.parentNode,!0,a)}}function Ca(t,n){var i=n.parentNode==null?t.root:n.parentNode;t.curTreeNode===n&&(t.curTreeNode=null),t.curEditTreeNode===n&&(t.curEditTreeNode=null),e("#"+n.tId).remove();for(var s=-1,o=0;o<i[t.nodesCol].length;o++)i[t.nodesCol][o].tId==n.tId&&(s=o);s>=0&&i[t.nodesCol].splice(s,1),i[t.nodesCol].length<1?(i.isParent=!1,i.open=!1,s=e("#"+i.tId+u),o=e("#"+i.tId+w),i=e("#"+i.tId+r),F(o,J),R(i,J),s.css("display","none")):t.showLine&&(i[t.nodesCol][i[t.nodesCol].length-1].isLastNode=!0,i[t.nodesCol][i[t.nodesCol].length-1].isFirstNode=i[t.nodesCol].length==1,s=e("#"+i[t.nodesCol][i[t.nodesCol].length-1].tId+u),o=e("#"+i[t.nodesCol][i[t.nodesCol].length-1].tId+w),e("#"+i[t.nodesCol][i[t.nodesCol].length-1].tId+r),i==t.root?i[t.nodesCol].length==1?F(o,Ea):(i=e("#"+i[t.nodesCol][0].tId+w),F(i,Fa),F(o,ha)):F(o,ha),s.removeClass(Ga))}function $(e,t){return Na(e,e.root[e.nodesCol],"tId",t)}function Na(e,t,n,r){if(!t||!n)return null;for(var i=0;i<t.length;i++){if(t[i][n]==r)return t[i];var s=Na(e,t[i][e.nodesCol],n,r);if(s)return s}return null}function eb(e,t,n,r){if(!t||!n)return[];for(var i=[],s=0;s<t.length;s++)t[s][n]==r&&i.push(t[s]),i=i.concat(eb(e,t[s][e.nodesCol],n,r));return i}function fb(t){t.curTreeNode&&(e("#"+t.curTreeNode.tId+o).removeClass(wa),e("#"+t.curTreeNode.tId+K).text(t.curTreeNode[t.nameCol]),ca(t,t.curTreeNode),t.curTreeNode=null)}function wb(t){t.curEditTreeNode&&(e("#"+t.curEditTreeNode.tId+o).removeClass(gb),e("#"+t.curEditTreeNode.tId+Oa).unbind(),e("#"+t.curEditTreeNode.tId+K).text(t.curEditTreeNode[t.nameCol]),t.curEditTreeNode.editNameStatus=!1,t.curEditTreeNode=null)}function O(t,n){if(t.curTreeNode!=n||!!n.editNameStatus){fb(t),wb(t);if(t.editable&&n.editNameStatus){e("#"+n.tId+K).html("<input type=text class='rename' id='"+n.tId+Oa+"'>");var r=e("#"+n.tId+Oa);r.attr("value",n[t.nameCol]),r.focus(),pb(r.get(0),n[t.nameCol].length),r.bind("blur",function(){hb(this.value,t,n)}).bind("keypress",function(e){e.keyCode=="13"&&hb(this.value,t,n)}).bind("click",function(){return!1}).bind("dblclick",function(){return!1}),e("#"+n.tId+o).addClass(gb),t.curEditTreeNode=n}else e("#"+n.tId+o).addClass(wa);Va(t,n),t.curTreeNode=n}}function hb(t,n,r){r[n.nameCol]=t,e("#"+n.treeObjId).trigger(ma,[n.treeObjId,r]),O(n,r)}function ib(e,t,n){if(!t)return[];for(var r=[],i=0;i<t.length;i++){t[i][e.checkedCol]==n&&(r=r.concat([t[i]]));var s=ib(e,t[i][e.nodesCol],n);s.length>0&&(r=r.concat(s))}return r}function jb(e,t){if(!t)return[];for(var n=[],r=0;r<t.length;r++){t[r][e.checkedCol]!=t[r].checkedOld&&(n=n.concat([t[r]]));var i=jb(e,t[r][e.nodesCol]);i.length>0&&(n=n.concat(i))}return n}function Ma(e,t){var n=e.treeNodeKey,r=e.treeNodeParentKey;if(!n||n==""||!t)return[];if(Object.prototype.toString.apply(t)==="[object Array]"){for(var i=[],s=[],o=0;o<t.length;o++)s[t[o][n]]=t[o];for(o=0;o<t.length;o++)t[o][r]&&s[t[o][r]]?(s[t[o][r]][e.nodesCol]||(s[t[o][r]][e.nodesCol]=[]),s[t[o][r]][e.nodesCol].push(t[o])):i.push(t[o]);return i}return[t]}function Pa(e,t){if(!t)return[];var n=[];if(Object.prototype.toString.apply(t)==="[object Array]")for(var r=0;r<t.length;r++)n.push(t[r]),t[r][e.nodesCol]&&(n=n.concat(Pa(e,t[r][e.nodesCol])));else n.push(t),t[e.nodesCol]&&(n=n.concat(Pa(e,t[e.nodesCol])));return n}function xb(){return{container:null,setting:null,init:function(e){return this.container=e,this.setting=G[e.attr("id")],this},refresh:function(){e("#"+this.setting.treeObjId).empty(),this.setting.curTreeNode=null,this.setting.curEditTreeNode=null,this.setting.dragStatus=0,this.setting.dragNodeShowBefore=!1,this.setting.checkRadioCheckedList=[],ua=0,S(this.setting,0,this.setting.root[this.setting.nodesCol])},setEditable:function(e){return this.setting.editable=e,this.refresh()},transformTozTreeNodes:function(e){return Ma(this.setting,e)},transformToArray:function(e){return Pa(this.setting,e)},getNodes:function(){return this.setting.root[this.setting.nodesCol]},getSelectedNode:function(){return this.setting.curTreeNode},getCheckedNodes:function(e){return e=e!=0,ib(this.setting,this.setting.root[this.setting.nodesCol],e)},getChangeCheckedNodes:function(){return jb(this.setting,this.setting.root[this.setting.nodesCol])},getNodeByTId:function(e){if(e)return $(this.setting,e)},getNodeByParam:function(e,t){if(e)return Na(this.setting,this.setting.root[this.setting.nodesCol],e,t)},getNodesByParam:function(e,t){if(e)return eb(this.setting,this.setting.root[this.setting.nodesCol],e,t)},getNodeIndex:function(e){if(e){for(var t=e.parentNode==null?this.setting.root:e.parentNode,n=0;n<t[this.setting.nodesCol].length;n++)if(t[this.setting.nodesCol][n]==e)return n;return-1}},getSetting:function(){var t=this.setting,n={checkType:{},callback:{}},r=t.checkType;t.checkType=undefined;var i=t.callback;t.callback=undefined;var s=t.root;return t.root=undefined,e.extend(n,t),t.checkType=r,t.callback=i,t.root=s,e.extend(!0,n.checkType,r),e.extend(n.callback,i),n},updateSetting:function(t){if(t){var n=this.setting,r=n.treeObjId,i=t.checkType;t.checkType=undefined;var s=t.callback;t.callback=undefined;var o=t.root;t.root=undefined,e.extend(n,t),t.checkType=i,t.callback=s,t.root=o,e.extend(!0,n.checkType,i),e.extend(n.callback,s),n.treeObjId=r,n.treeObj=this.container}},expandAll:function(e){La(this.setting,null,e,!0)},expandNode:function(t,n,i){t&&(n&&(t.parentNode&&Y(this.setting,t.parentNode,n,!1),B(this.setting,t,n,!0)),i?La(this.setting,t,n,!1,function(){e("#"+t.tId+r).focus().blur()}):t.open!=n&&(Ba(this.setting,t),e("#"+t.tId+r).focus().blur()))},selectNode:function(t){t&&(O(this.setting,t),t.parentNode?Y(this.setting,t.parentNode,!0,!1,function(){e("#"+t.tId+r).focus().blur()}):e("#"+t.tId+r).focus().blur())},cancleSelectedNode:function(){this.cancelSelectedNode()},cancelSelectedNode:function(){fb(this.setting)},checkAllNodes:function(e){this.setting.checkable&&ja(this.setting,this.setting.root,e==1)},reAsyncChildNodes:function(t,n){if(this.setting.async){var r=!t;r&&(t=this.setting.root),n=="refresh"&&(t[this.setting.nodesCol]=[],r?this.setting.treeObj.empty():e("#"+t.tId+u).empty()),Ka(this.setting,r?null:t)}},addNodes:function(e,t,n){t&&(e||(e=null),fa(this.setting,e,t,n==1))},updateNode:function(t,n){if(t){var r=e("#"+t.tId+I);this.setting.checkable&&(n==1&&Sa(this.setting,t),A(this.setting,r,t),T(this.setting,t)),Ra(this.setting,t),Ta(t),Ua(this.setting,t),H(this.setting,t)}},moveNode:function(t,n,r){n&&(!t||!(n.parentNode==t&&r==x||e("#"+n.tId).find("#"+t.tId).length>0))&&(t||(t=null),Da(this.setting,t,n,r,!1))},removeNode:function(e){e&&Ca(this.setting,e)}}}var ka="ZTREE_CLICK",la="ZTREE_CHANGE",ma="ZTREE_RENAME",na="ZTREE_REMOVE",oa="ZTREE_DRAG",Z="ZTREE_DROP",pa="ZTREE_EXPAND",qa="ZTREE_COLLAPSE",ra="ZTREE_ASYNC_SUCCESS",sa="ZTREE_ASYNC_ERROR",w="_switch",r="_ico",K="_span",Oa="_input",I="_check",ia="_edit",X="_remove",u="_ul",o="_a",Ea="root",Fa="roots",Za="center",ha="bottom",$a="noLine",Ga="line",M="open",N="close",J="docu",wa="curSelectedNode",gb="curSelectedNode_Edit",xa="tmpTargetTree",ya="tmpTargetNode",P="radio",vb="chk",tb="false",sb="true",ab="full",bb="part",ub="focus",va="all",x="inner",W="before",da="after",Xa="5",G=[],ua=0;e.fn.zTree=function(t,n){var r={treeObjId:"",checkable:!1,editable:!1,edit_renameBtn:!0,edit_removeBtn:!0,showLine:!0,curTreeNode:null,curEditTreeNode:null,dragStatus:0,dragNodeShowBefore:!1,checkStyle:"checkbox",checkType:{Y:"ps",N:"ps"},checkRadioType:"level",checkRadioCheckedList:[],async:!1,asyncUrl:"",asyncParam:[],asyncParamOther:[],isSimpleData:!1,treeNodeKey:"",treeNodeParentKey:"",nameCol:"name",nodesCol:"nodes",checkedCol:"checked",expandSpeed:"fast",expandTriggerFlag:!1,addHoverDom:null,removeHoverDom:null,addDiyDom:null,root:{isRoot:!0,nodes:[]},callback:{beforeClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeChange:null,beforeDrag:null,beforeDrop:null,beforeRename:null,beforeRemove:null,beforeExpand:null,beforeCollapse:null,click:null,rightClick:null,mouseDown:null,mouseUp:null,change:null,drag:null,drop:null,rename:null,remove:null,expand:null,collapse:null,asyncSuccess:null,asyncError:null}};if(t){var i=t.checkType;t.checkType=undefined;var s=t.callback;t.callback=undefined;var o=t.root;t.root=undefined,e.extend(r,t),t.checkType=i,e.extend(!0,r.checkType,i),t.callback=s,e.extend(r.callback,s),t.root=o,e.extend(r.root,o)}return r.treeObjId=this.attr("id"),r.treeObj=this,r.root.tId=-1,r.root.name="ZTREE ROOT",r.root.isRoot=!0,r.checkRadioCheckedList=[],r.curTreeNode=null,r.curEditTreeNode=null,r.dragNodeShowBefore=!1,r.dragStatus=0,r.expandTriggerFlag=!1,r.root[r.nodesCol]||(r.root[r.nodesCol]=[]),ua=0,n&&(r.root[r.nodesCol]=n),r.isSimpleData&&(r.root[r.nodesCol]=Ma(r,r.root[r.nodesCol])),G[r.treeObjId]=r,e("#"+r.treeObjId).empty(),kb(r,this),r.root[r.nodesCol]&&r.root[r.nodesCol].length>0?S(r,0,r.root[r.nodesCol]):r.async&&r.asyncUrl&&r.asyncUrl.length>0&&Ka(r),(new xb).init(this)};var ga=[]})(jQuery)});