define("control/panel",["leaflet","core/namespace","plugins/mcscroll","util/tool"],function(e){e.ICT.Panel=e.Class.extend({initialize:function(){}}),e.ICT.PopPanel=e.ICT.Panel.extend({includes:e.Mixin.Events,options:{title:"add your title",width:400,height:300,position:"center",left:null,right:null,top:null,bottom:null,zIndex:1e3,scroll:!1,className:null,isDrag:!0,ismodal:!1,animation:!0,disableSelect:!0,contentHTML:"<span>add your content here</span>"},initialize:function(t){e.setOptions(this,t),this.options.ismodal&&(this.options.isDrag=!1),this._isShow=!1,this._container=null},show:function(){return this._container===null&&(this._initUi(),this._initEvents()),this._isShow||(this.options.animation?this._container.fadeIn("fast"):this._container.show(),this._isShow=!0),this},close:function(){return this._container!==null&&this._isShow&&(this.options.animation?this._container.fadeOut():this._container.hide(),this._isShow=!1),this},remove:function(e){e===undefined&&(e=!0),this._container&&(this._container.remove(),this._container=null,e&&this.fire("popPanelRemove",{obj:this}))},getContainer:function(){return this._container},setContent:function(e){this._container===null&&(this._initUi(),this._initEvents());var t=e;typeof e=="string"&&(t=$(e));var n=$('<div class="container-content"></div>');return n.append(t),this._container.find(".container-content").remove(),this._container.append(n),this._setContentCss(),this.options.scroll&&n.mCustomScrollbar({theme:"minimal-dark"}),this},_initUi:function(){var t=$('<div class="ictPanel-popPanel-container"></div>'),n=$('<div class="container-title"></div>'),r=$('<div class="container-content"></div>'),i="<span>"+this.options.title+"</span>"+'<img class="close" src="themes/images/dialog/dialog_close.png"/>';t.attr("id","ictPanel-popPanel-container"+e.stamp({})),n.attr("id","container-title"+e.stamp({})),n.html(i),r.html(this.options.contentHTML),t.append(n).append(r),this.options.ismodal&&t.prepend('<div class="ict_modal_backdrop"></div>'),$("body").append(t),this.options.className&&t.addClass(this.options.className),this.options.disableSelect&&t.addClass("disableSelect"),this.options.scroll&&r.mCustomScrollbar({theme:"minimal-dark"}),this.options.isDrag&&e.ict.app.util.tool.drag(t.attr("id"),n.attr("id")),this._container=t,this._setCotainerCss(),this._setTitleCss(),this._setContentCss()},_setCotainerCss:function(){var e={position:"fixed",display:"none",backgroundColor:"#fff"};this.options.left&&(e.left=this.options.left+"px"),this.options.right&&(e.right=this.options.right+"px"),this.options.top&&(e.top=this.options.top+"px"),this.options.bottom&&(e.bottom=this.options.bottom+"px"),!this.options.left&&!this.options.right&&!this.options.top&&!this.options.bottom&&(e.left=0,e.right=0,e.top=0,e.bottom=0,e.marginLeft="auto",e.marginRight="auto",e.marginBottom="auto",e.marginTop="auto"),e.width=this.options.width+"px",e.height=this.options.height+"px",e.border="1px solid rgb(169, 169, 169)",e.borderRadius="6px",e.boxShadow="silver 2px 2px 5px",e.zIndex=this.options.zIndex,this._container.css(e)},_setTitleCss:function(){this._container.find(".container-title").css({position:"relative",left:0,top:0,width:"100%",height:"35px",backgroundColor:"#244474",lineHeight:"35px",textAlign:"center",cursor:"pointer",borderTopLeftRadius:"6px",borderTopRightRadius:"6px"}).find("span").css({fontSize:"14px",fontWeight:"normal",color:"#fff"}).end().find("img").css({"float":"right",margin:"10px"})},_setContentCss:function(){this._container.find(".container-content").css({position:"relative",left:0,top:0,width:"100%",overFlowX:"hidden",overFlowY:"auto",padding:"10px",backgroundColor:"#fff",borderBottomLeftRadius:"6px",borderBottomRightRadius:"6px"});var e=this._container.height()-this._container.find(".container-title").height();this._container.find(".container-content").outerHeight(e)},_initEvents:function(){var e=this;this._container.find(".container-title .close").on("click",function(t){e.remove()}),this._container.find(".ict_modal_backdrop").on("click",function(){e.remove()})}}),e.ICT.DrawPopPanel=e.ICT.PopPanel.extend({initialize:function(t,n,r){this.layer=t,this.layerType=n,this.tool=e.ict.app.util.tool;var r=r||{};r.width=400,r.height=202;switch(n){case"circle":r.contentHTML=this.getCircleContent(),r.title=$.i18n.prop("control_drawpoppanel_circle_title");break;case"rectangle":r.contentHTML=this.getRectContent(),r.title=$.i18n.prop("control_drawpoppanel_rect_title"),r.width=420;break;case"polygon":r.contentHTML=this.getPolygonContent(),r.title="绘制多边形区域",r.height=300;break;default:}e.ICT.PopPanel.prototype.initialize.call(this,r)},updateContent:function(){switch(this.layerType){case"circle":var e=this.getCircleContent();break;case"rectangle":var e=this.getRectContent();break;case"polygon":var e=this.getPolygonContent();break;default:}this.setContent(e),this._initEvents()},getCircleContent:function(){var t=this.layer.getLatLng(),n=this.layer.getRadius();n=e.ict.app.util.tool.convertMileToNmile(n);var r=$.i18n.prop("control_drawpoppanel_circle_center"),i=$.i18n.prop("control_drawpoppanel_circle_radius"),s=$.i18n.prop("control_drawpoppanel_circle_unit"),o=[];return o.push('<div class="drawPopPanel circleContainer">'),o.push("<ul>"),o.push("<li><label>"+r+"</label>"+this.getItemHtml(t)+"</li>"),o.push("<li><label>"+i+'</label><input type="number" class="circleRadius" value="'+n+'">&nbsp&nbsp<label>'+s+"</label></li>"),o.push("</ul>"),o.push(this.getBtnHTML()),o.push("</div>"),o.join("")},getRectContent:function(){var e=this.layer.getBounds().getSouthWest(),t=this.layer.getBounds().getNorthEast(),n=$.i18n.prop("control_drawpoppanel_rect_lb"),r=$.i18n.prop("control_drawpoppanel_rect_rt"),i=[];return i.push('<div class="drawPopPanel rectContainer">'),i.push("<ul>"),i.push("<li><label>"+n+"</label>"+this.getItemHtml(e)+"</li>"),i.push("<li><label>"+r+"</label>"+this.getItemHtml(t)+"</li>"),i.push("</ul>"),i.push(this.getBtnHTML()),i.push("</div>"),i.join("")},getPolygonContent:function(){var e=this.layer.getLatLngs(),t=[];e=e[0],t.push('<div class="drawPopPanel polygonContainer">'),t.push("<div><ul>");for(var n=0,r=e.length;n<r;n++)t.push("<li><label>"+(n+1)+"</label>"+this.getItemHtml(e[n])+"</li>");return t.push("</ul></div>"),t.push(this.getBtnHTML()),t.push("</div>"),t.join("")},getBtnHTML:function(){var e=$.i18n.prop("common_btn_ok"),t=$.i18n.prop("common_btn_cancel"),n=[];return n.push('<div class="btnDiv">'),n.push('<button type="button" class="btn okBtn">'+e+"</button>"),n.push('<button type="button" class="btn cancelBtn">'+t+"</button>"),n.push("</div>"),n.join("")},getItemHtml:function(e){var t=[],n=this.tool.latlngTodfm(e.lat,"lat"),r=this.tool.latlngTodfm(e.lng,"lng");return t.push('<table class="latlngsTable">'),t.push("<tr>"),t.push('<td class="lat lat_d"><input type="text" value="'+n[0]+'"></td>'),t.push('<td class="dfm">°</td>'),t.push('<td class="lat lat_f"><input type="text" value="'+n[1]+'"></td>'),t.push('<td class="dfm">′</td>'),t.push('<td class="lat lat_m"><input type="text" value="'+n[2]+'"></td>'),t.push('<td class="dfm">″</td>'),n[3]=="N"?(t.push('<td class="latNS lat_N active">N</td>'),t.push('<td class="latNS lat_S">S</td>')):(t.push('<td class="latNS lat_N">N</td>'),t.push('<td class="latNS lat_S active">S</td>')),t.push('<td class="space">&nbsp&nbsp</td>'),t.push('<td class="lng lng_d"><input type="text" value="'+r[0]+'"></td>'),t.push('<td class="dfm">°</td>'),t.push('<td class="lng lng_f"><input type="text" value="'+r[1]+'"></td>'),t.push('<td class="dfm">′</td>'),t.push('<td class="lng lng_m"><input type="text" value="'+r[2]+'"></td>'),t.push('<td class="dfm">″</td>'),r[3]=="W"?(t.push('<td class="lngWE lng_W active">W</td>'),t.push('<td class="lngWE lng_E">E</td>')):(t.push('<td class="lngWE lng_W">W</td>'),t.push('<td class="lngWE lng_E active">E</td>')),t.push("</tr>"),t.push("</table>"),t.join("")},getLatLngs:function(){var t=[],n=this._container.find(".latlngsTable");for(var r=0,i=n.length;r<i;r++){var s=$(n[r]).find("tr"),o=s.find(".lat_d input").val(),u=s.find(".lat_f input").val(),a=s.find(".lat_m input").val(),f=s.find(".latNS.active").text(),l=s.find(".lng_d input").val(),c=s.find(".lng_f input").val(),h=s.find(".lng_m input").val();we=s.find(".lngWE.active").text();var p=Math.abs(parseFloat(o))+parseFloat(u/60)+parseFloat(a/3600),d=Math.abs(parseFloat(l))+parseFloat(c/60)+parseFloat(h/3600);p=f=="S"?-p:p,d=we=="W"?-d:d;var v=e.latLng([p,d]);t.push(v)}return t},getCircleRadius:function(){var t=this._container.find(".circleContainer .circleRadius").val();return t=e.ict.app.util.tool.convertNmileToMile(t),parseFloat(t)},_latlngChangeEvt:function(){this.layer.editing&&this.layer.editing.disable();var t=this.getLatLngs();if(this.layerType=="circle"){var n=this.getCircleRadius();this.layer.setLatLng(t[0]),this.layer.setRadius(n)}else if(this.layerType=="rectangle"){var r=e.latLngBounds(t);this.layer.setBounds(r)}else this.layerType=="polygon"&&this.layer.setLatLngs(t);this.layer.editing&&this.layer.editing.enable()},_initEvents:function(){var e=this;e._container.find(".container-title .close").on("click",function(t){t.stopPropagation(),e.remove(),e.layer.remove(),e.layer=null,e.fire("CancelDraw",{obj:e})}),e._container.find(".container-content .okBtn").on("click",function(t){t.stopPropagation(),e.remove(),e.layer.editing&&e.layer.editing.disable(),e.fire("OkDraw",{layer:e.layer,obj:e})}),e._container.find(".container-content .cancelBtn").on("click",function(t){t.stopPropagation(),e.remove(),e.layer.remove(),e.layer=null,e.fire("CancelDraw",{obj:e})}),e._container.find(".container-content input").on("change focusout",function(t){e._latlngChangeEvt()}),e._container.find(".container-content .latlngsTable .latNS").on("click",function(t){$(this).addClass("active").siblings(".latNS").removeClass("active"),e._latlngChangeEvt()}),e._container.find(".container-content .latlngsTable .lngWE").on("click",function(t){$(this).addClass("active").siblings(".lngWE").removeClass("active"),e._latlngChangeEvt()})}}),e.ICT.TablePanel=e.Class.extend({includes:e.Mixin.Events,options:{height:100,thData:[],tbData:[],thLineHeight:34,tbLineHeight:32},initialize:function(t){e.setOptions(this,t),this._tableObj=null},getTableObj:function(){return this._tableObj===null&&this._init(),this._tableObj},getTableHTML:function(){return this._tableObj===null&&this._init(),this._tableObj.get(0).outerHTML},updateData:function(e){},addTo:function(e){return this._tableObj===null&&this._init(),e.html(this._tableObj),this._tableObj.find(".tbDiv").mCustomScrollbar({theme:"minimal-dark"}),this._initStyle(),this},_init:function(){this._initUi(),this._initEvents()},_initUi:function(){var e=$('<div class="tableDiv"></div>'),t=$('<div class="thDiv"></div>'),n=$('<div class="tbDiv"></div>'),r="",i="",s=!1;for(var o=0,u=this.options.thData.length;o<u;o++)this.options.thData[o].width&&(s=!0);r+="<table><tr>";for(var o=0,u=this.options.thData.length;o<u;o++)s===!0&&this.options.thData[o].width?r+='<td style="width:'+this.options.thData[o].width+"%"+'">'+this.options.thData[o].value+"</td>":r+="<td>"+this.options.thData[o].value+"</td>";r+="</tr></table>",t.html(r),i+="<table>";for(var o=0,u=this.options.tbData.length;o<u;o++){i+="<tr>";for(var a=0;a<this.options.thData.length;a++)s===!0&&this.options.thData[a].width?i+='<td style="width:'+this.options.thData[a].width+"%"+'">'+this.options.tbData[o][this.options.thData[a].name]+"</td>":i+="<td>"+this.options.tbData[o][this.options.thData[a].name]+"</td>";i+="</tr>"}i+="</table>",n.html(i),e.append(t).append(n),this._tableObj=e},_initStyle:function(){if(this._tableObj===null)return;var e=this.options.height-this.options.thLineHeight,t=parseInt(e/this.options.tbLineHeight),n=parseInt(e/t);this._tableObj.css({position:"relative",width:"100%",height:this.options.height+"px",borderBottom:"solid 1px #d1d1d1",margin:0,padding:0}),this._tableObj.find(".thDiv").css({position:"relative",width:"100%",height:this.options.thLineHeight+"px",overflow:"hidden",margin:0,padding:0}),this._tableObj.find(".tbDiv").css({position:"relative",width:"100%",height:e+"px",margin:0,padding:0}),this._tableObj.find("table").css({tableLayout:"fixed",borderCollapse:"collapse",width:"100%"}),this._tableObj.find(".thDiv table tr").css({fontWeight:"bold",fontSize:"11px",backgroundColor:"rgb(243,243,243)",lineHeight:this.options.thLineHeight+"px"}),this._tableObj.find(".tbDiv table tr").css({lineHeight:n+"px"}),this._tableObj.find("table td").css({border:"solid 1px #d1d1d1",textAlign:"center"})},_initEvents:function(){}})});